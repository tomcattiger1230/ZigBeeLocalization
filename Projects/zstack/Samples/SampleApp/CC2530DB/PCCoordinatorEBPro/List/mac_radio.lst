###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.20.2.41139 for 8051             16/Mar/2016  16:40:12 #
# Copyright 2004-2013 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#                                                                             #
#    Source file        =  C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Comp #
#                          onents\mac\low_level\srf04\mac_radio.c             #
#    Command line       =  -f C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\P #
#                          rojects\zstack\Samples\SampleApp\CC2530DB\..\..\.. #
#                          \Tools\CC2530DB\f8wCoord.cfg (-DCPU32MHZ           #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DZDO_COORDINATOR -DRTR_NWK -DBLINK_LEDS) -f     #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\To #
#                          ols\CC2530DB\f8wConfig.cfg (-DSECURE=0             #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFF1                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=TRUE      #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Comp #
#                          onents\mac\low_level\srf04\mac_radio.c -D          #
#                          ZIGBEEPRO -D ZTOOL_P1 -D xMT_TASK -D xMT_SYS_FUNC  #
#                          -D xMT_ZDO_FUNC -D LCD_SUPPORTED=DEBUG -lC         #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\PCCoordinat #
#                          orEBPro\List\ -lA C:\Users\ArnoldWorkStation\Deskt #
#                          op\ZigbeeTest\Projects\zstack\Samples\SampleApp\CC #
#                          2530DB\PCCoordinatorEBPro\List\ --diag_suppress    #
#                          Pe001,Pa010 -o C:\Users\ArnoldWorkStation\Desktop\ #
#                          ZigbeeTest\Projects\zstack\Samples\SampleApp\CC253 #
#                          0DB\PCCoordinatorEBPro\Obj\ -e --no_cse            #
#                          --no_unroll --no_inline --no_code_motion           #
#                          --no_tbaa --debug --core=plain --dptr=16,1         #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\P #
#                          rojects\zstack\Samples\SampleApp\CC2530DB\ -I      #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\SOURCE\  #
#                          -I C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\P #
#                          rojects\zstack\Samples\SampleApp\CC2530DB\..\..\.. #
#                          \ZMAIN\TI2530DB\ -I C:\Users\ArnoldWorkStation\Des #
#                          ktop\ZigbeeTest\Projects\zstack\Samples\SampleApp\ #
#                          CC2530DB\..\..\..\..\..\COMPONENTS\MT\ -I          #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\HAL\INCLUDE\ -I                     #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\HAL\TARGET\CC2530EB\ -I             #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\OSAL\MCU\CCSOC\ -I                  #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\OSAL\INCLUDE\ -I                    #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\STACK\AF\ -I                        #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\STACK\NWK\ -I                       #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\STACK\SEC\ -I                       #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\STACK\SAPI\ -I                      #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\STACK\SYS\ -I                       #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\STACK\ZDO\ -I                       #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\ZMAC\F8W\ -I                        #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\ZMAC\ -I C:\Users\ArnoldWorkStation #
#                          \Desktop\ZigbeeTest\Projects\zstack\Samples\Sample #
#                          App\CC2530DB\..\..\..\..\..\COMPONENTS\SERVICES\SA #
#                          DDR\ -I C:\Users\ArnoldWorkStation\Desktop\ZigbeeT #
#                          est\Projects\zstack\Samples\SampleApp\CC2530DB\..\ #
#                          ..\..\..\..\COMPONENTS\SERVICES\SDATA\ -I          #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\MAC\INCLUDE\ -I                     #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\MAC\HIGH_LEVEL\ -I                  #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\MAC\LOW_LEVEL\srf04\ -I             #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\MAC\LOW_LEVEL\srf04\SINGLE_CHIP\    #
#                          -On --require_prototypes                           #
#    List file          =  C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\PCCoordinat #
#                          orEBPro\List\mac_radio.lst                         #
#    Object file        =  C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\PCCoordinat #
#                          orEBPro\Obj\mac_radio.r51                          #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Components\mac\low_level\srf04\mac_radio.c
      1          /**************************************************************************************************
      2            Filename:       mac_radio.c
      3            Revised:        $Date: 2007-09-11 10:58:41 -0700 (Tue, 11 Sep 2007) $
      4            Revision:       $Revision: 15371 $
      5          
      6            Description:    Describe the purpose and contents of the file.
      7          
      8          
      9            Copyright 2006-2009 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /* ------------------------------------------------------------------------------------------------
     41           *                                          Includes
     42           * ------------------------------------------------------------------------------------------------
     43           */
     44          
     45          /* hal */
     46          #include "hal_types.h"
     47          
     48          /* high-level */
     49          #include "mac_pib.h"
     50          
     51          /* exported low-level */
     52          #include "mac_low_level.h"
     53          
     54          /* low-level specific */
     55          #include "mac_radio.h"
     56          #include "mac_tx.h"
     57          #include "mac_rx.h"
     58          #include "mac_rx_onoff.h"
     59          #include "mac_sleep.h"
     60          #include "mac_backoff_timer.h"
     61          
     62          /* target specific */
     63          #include "mac_radio_defs.h"

   \                                 In  segment SFR_AN, at 0xa8
   \   union <unnamed> volatile __sfr _A_IEN0
   \                     _A_IEN0:
   \   000000                DS 1
     64          
     65          /* debug */
     66          #include "mac_assert.h"
     67          
     68          
     69          /* ------------------------------------------------------------------------------------------------
     70           *                                          Includes
     71           * ------------------------------------------------------------------------------------------------
     72           */
     73          #define ED_RF_POWER_MIN_DBM   (MAC_RADIO_RECEIVER_SENSITIVITY_DBM + MAC_SPEC_ED_MIN_DBM_ABOVE_RECEIVER_SENSITIVITY)
     74          #define ED_RF_POWER_MAX_DBM   MAC_RADIO_RECEIVER_SATURATION_DBM
     75          
     76          
     77          /* ------------------------------------------------------------------------------------------------
     78           *                                        Global Variables
     79           * ------------------------------------------------------------------------------------------------
     80           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     81          uint8 macPhyTxPower;
   \                     macPhyTxPower:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     82          uint8 macPhyChannel;
   \                     macPhyChannel:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     83          
     84          
     85          /* ------------------------------------------------------------------------------------------------
     86           *                                        Local Variables
     87           * ------------------------------------------------------------------------------------------------
     88           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     89          static uint8 reqChannel;
   \                     reqChannel:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     90          static uint8 reqTxPower;
   \                     reqTxPower:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
     91          
     92          
     93          /* ------------------------------------------------------------------------------------------------
     94           *                                        Local Functions
     95           * ------------------------------------------------------------------------------------------------
     96           */
     97          static uint8 radioComputeED(int8 rssiDbm);
     98          
     99          
    100          /**************************************************************************************************
    101           * @fn          macRadioInit
    102           *
    103           * @brief       Initialize radio software.
    104           *
    105           * @param       none
    106           *
    107           * @return      none
    108           **************************************************************************************************
    109           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    110          MAC_INTERNAL_API void macRadioInit(void)
   \                     macRadioInit:
    111          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    112            /* variable initialization for this module */
    113            reqChannel    = MAC_RADIO_CHANNEL_DEFAULT;
   \   000004   90....       MOV     DPTR,#reqChannel
   \   000007   740B         MOV     A,#0xb
   \   000009   F0           MOVX    @DPTR,A
    114            macPhyChannel = MAC_RADIO_CHANNEL_DEFAULT;
   \   00000A   90....       MOV     DPTR,#macPhyChannel
   \   00000D   740B         MOV     A,#0xb
   \   00000F   F0           MOVX    @DPTR,A
    115            reqTxPower    = MAC_RADIO_TX_POWER_DEFAULT;
   \   000010   90....       MOV     DPTR,#reqTxPower
   \   000013   7405         MOV     A,#0x5
   \   000015   F0           MOVX    @DPTR,A
    116            macPhyTxPower = MAC_RADIO_TX_POWER_DEFAULT;
   \   000016   90....       MOV     DPTR,#macPhyTxPower
   \   000019   7405         MOV     A,#0x5
   \   00001B   F0           MOVX    @DPTR,A
    117          }
   \   00001C   D083         POP     DPH
   \   00001E   D082         POP     DPL
   \   000020   02....       LJMP    ?BRET
    118          
    119          
    120          /**************************************************************************************************
    121           * @fn          macRadioReset
    122           *
    123           * @brief       Resets the radio module.
    124           *
    125           * @param       none
    126           *
    127           * @return      none
    128           **************************************************************************************************
    129           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    130          MAC_INTERNAL_API void macRadioReset(void)
   \                     macRadioReset:
    131          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    132            macRadioStopScan();
   \   000004                ; Setup parameters for call to function macRadioStopScan
   \   000004   12....       LCALL   ??macRadioStopScan?relay
    133            macRadioEnergyDetectStop();
   \   000007                ; Setup parameters for call to function macRadioEnergyDetectStop
   \   000007   12....       LCALL   ??macRadioEnergyDetectStop?relay
   \   00000A   E9           MOV     A,R1
    134          }
   \   00000B   D083         POP     DPH
   \   00000D   D082         POP     DPL
   \   00000F   02....       LJMP    ?BRET
    135          
    136          
    137          /**************************************************************************************************
    138           * @fn          macRadioRandomByte
    139           *
    140           * @brief       Return a random byte derived from previously set random seed.
    141           *
    142           * @param       none
    143           *
    144           * @return      a random byte
    145           **************************************************************************************************
    146           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    147          MAC_INTERNAL_API uint8 macRadioRandomByte(void)
   \                     macRadioRandomByte:
    148          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    149            return(MAC_RADIO_RANDOM_BYTE());
   \   000004                ; Setup parameters for call to function macMcuRandomByte
   \   000004   12....       LCALL   ??macMcuRandomByte?relay
   \   000007   D083         POP     DPH
   \   000009   D082         POP     DPL
   \   00000B   02....       LJMP    ?BRET
    150          }
    151          
    152          
    153          /**************************************************************************************************
    154           * @fn          macRadioSetPanCoordinator
    155           *
    156           * @brief       Configure the pan coordinator status of the radio
    157           *
    158           * @param       panCoordFlag - non-zero to configure radio to be pan coordinator
    159           *                             zero to configure radio as NON pan coordinator
    160           *
    161           * @return      none
    162           **************************************************************************************************
    163           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    164          MAC_INTERNAL_API void macRadioSetPanCoordinator(uint8 panCoordFlag)
   \                     macRadioSetPanCoordinator:
    165          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    166            /* abstracted radio configuration */
    167            MAC_RADIO_SET_PAN_COORDINATOR(panCoordFlag);
   \   000005   906180       MOV     DPTR,#0x6180
   \   000008   E0           MOVX    A,@DPTR
   \   000009   FA           MOV     R2,A
   \   00000A   E9           MOV     A,R1
   \   00000B   6004         JZ      ??macRadioSetPanCoordinator_0
   \   00000D   D2..         SETB    ?VB.0
   \   00000F   8002         SJMP    ??macRadioSetPanCoordinator_1
   \                     ??macRadioSetPanCoordinator_0:
   \   000011   C2..         CLR     ?VB.0
   \                     ??macRadioSetPanCoordinator_1:
   \   000013   75F002       MOV     B,#0x2
   \   000016   A2..         MOV     C,?VB.0
   \   000018   E4           CLR     A
   \   000019   33           RLC     A
   \   00001A   A4           MUL     AB
   \   00001B   F8           MOV     R0,A
   \   00001C   74FD         MOV     A,#-0x3
   \   00001E   5A           ANL     A,R2
   \   00001F   48           ORL     A,R0
   \   000020   906180       MOV     DPTR,#0x6180
   \   000023   F0           MOVX    @DPTR,A
    168          }
   \   000024   7F01         MOV     R7,#0x1
   \   000026   02....       LJMP    ?BANKED_LEAVE_XDATA
    169          
    170          
    171          /**************************************************************************************************
    172           * @fn          macRadioSetPanID
    173           *
    174           * @brief       Set the pan ID on the radio.
    175           *
    176           * @param       panID - 16 bit PAN identifier
    177           *
    178           * @return      none
    179           **************************************************************************************************
    180           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    181          void macRadioSetPanID(uint16 panID)
   \                     macRadioSetPanID:
    182          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    183            /* abstracted radio configuration */
    184            MAC_RADIO_SET_PAN_ID(panID);
   \   000004   EA           MOV     A,R2
   \   000005   906172       MOV     DPTR,#0x6172
   \   000008   F0           MOVX    @DPTR,A
   \   000009   EA           MOV     A,R2
   \   00000A   F8           MOV     R0,A
   \   00000B   EB           MOV     A,R3
   \   00000C   F9           MOV     R1,A
   \   00000D   E4           CLR     A
   \   00000E   E9           MOV     A,R1
   \   00000F   F8           MOV     R0,A
   \   000010   906173       MOV     DPTR,#0x6173
   \   000013   F0           MOVX    @DPTR,A
    185          }
   \   000014   D083         POP     DPH
   \   000016   D082         POP     DPL
   \   000018   02....       LJMP    ?BRET
    186          
    187          
    188          /**************************************************************************************************
    189           * @fn          macRadioSetShortAddr
    190           *
    191           * @brief       Set the short addrss on the radio.
    192           *
    193           * @param       shortAddr - 16 bit short address
    194           *
    195           * @return      none
    196           **************************************************************************************************
    197           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    198          MAC_INTERNAL_API void macRadioSetShortAddr(uint16 shortAddr)
   \                     macRadioSetShortAddr:
    199          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    200            /* abstracted radio configuration */
    201            MAC_RADIO_SET_SHORT_ADDR(shortAddr);
   \   000004   EA           MOV     A,R2
   \   000005   906174       MOV     DPTR,#0x6174
   \   000008   F0           MOVX    @DPTR,A
   \   000009   EA           MOV     A,R2
   \   00000A   F8           MOV     R0,A
   \   00000B   EB           MOV     A,R3
   \   00000C   F9           MOV     R1,A
   \   00000D   E4           CLR     A
   \   00000E   E9           MOV     A,R1
   \   00000F   F8           MOV     R0,A
   \   000010   906175       MOV     DPTR,#0x6175
   \   000013   F0           MOVX    @DPTR,A
    202          }
   \   000014   D083         POP     DPH
   \   000016   D082         POP     DPL
   \   000018   02....       LJMP    ?BRET
    203          
    204          
    205          /**************************************************************************************************
    206           * @fn          macRadioSetIEEEAddr
    207           *
    208           * @brief       Set the IEEE address on the radio.
    209           *
    210           * @param       pIEEEAddr - pointer to array holding 64 bit IEEE address; array must be little
    211           *                          endian format (starts with lowest signficant byte)
    212           *
    213           * @return      none
    214           **************************************************************************************************
    215           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    216          MAC_INTERNAL_API void macRadioSetIEEEAddr(uint8 * pIEEEAddr)
   \                     macRadioSetIEEEAddr:
    217          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    218            /* abstracted radio configuration */
    219            MAC_RADIO_SET_IEEE_ADDR(pIEEEAddr);
   \   000009                ; Setup parameters for call to function macMemWriteRam
   \   000009   7908         MOV     R1,#0x8
   \   00000B   EE           MOV     A,R6
   \   00000C   FC           MOV     R4,A
   \   00000D   EF           MOV     A,R7
   \   00000E   FD           MOV     R5,A
   \   00000F   7A6A         MOV     R2,#0x6a
   \   000011   7B61         MOV     R3,#0x61
   \   000013   12....       LCALL   ??macMemWriteRam?relay
    220          }
   \   000016   7F01         MOV     R7,#0x1
   \   000018   02....       LJMP    ?BANKED_LEAVE_XDATA
    221          
    222          
    223          /**************************************************************************************************
    224           * @fn          macRadioSetTxPower
    225           *
    226           * @brief       Set transmitter power of the radio.
    227           *
    228           * @param       txPower - the minus dBm for power but as a postive integer (or if configured
    229           *                        for it, txPower is the raw register value). If PA/LNA is installed
    230           *                        then txPower becomes positive dBm.
    231           *
    232           * @return      none
    233           **************************************************************************************************
    234           */
    235          #ifndef HAL_MAC_USE_REGISTER_POWER_VALUES
    236          /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
    237          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    238          MAC_INTERNAL_API void macRadioSetTxPower(uint8 txPower)
   \                     macRadioSetTxPower:
    239          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 2,R1
    240            halIntState_t  s;
    241          #if defined MAC_RUNTIME_CC2591 || defined MAC_RUNTIME_CC2590
    242            const uint8 CODE *pTable = macRadioDefsTxPwrTables[macRadioDefsRefTableId >> 4];
    243          #elif defined HAL_PA_LNA || defined HAL_PA_LNA_CC2590
    244            const uint8 CODE *pTable = macRadioDefsTxPwrTables[0];
    245          #else
    246            const uint8 CODE *pTable = macRadioDefsTxPwrBare;
   \   000007   7E..         MOV     R6,#macRadioDefsTxPwrBare & 0xff
   \   000009   7F..         MOV     R7,#(macRadioDefsTxPwrBare >> 8) & 0xff
    247          #endif
    248          
    249            /* if the selected dBm is out of range, use the closest available */
    250            if ((int8)txPower > (int8)pTable[MAC_RADIO_DEFS_TBL_TXPWR_FIRST_ENTRY])
   \   00000B   8E82         MOV     DPL,R6
   \   00000D   8F83         MOV     DPH,R7
   \   00000F   E4           CLR     A
   \   000010   93           MOVC    A,@A+DPTR
   \   000011   C3           CLR     C
   \   000012   95..         SUBB    A,?V0 + 2
   \   000014   A2D2         MOV     C,0xD0 /* PSW */.2
   \   000016   65D0         XRL     A,PSW
   \   000018   33           RLC     A
   \   000019   500A         JNC     ??macRadioSetTxPower_0
    251            {
    252              /* greater than base value -- out of table range */
    253              txPower = pTable[MAC_RADIO_DEFS_TBL_TXPWR_FIRST_ENTRY];
   \   00001B   8E82         MOV     DPL,R6
   \   00001D   8F83         MOV     DPH,R7
   \   00001F   E4           CLR     A
   \   000020   93           MOVC    A,@A+DPTR
   \   000021   F5..         MOV     ?V0 + 2,A
   \   000023   801C         SJMP    ??macRadioSetTxPower_1
    254            }
    255            else if ((int8)txPower < (int8)pTable[MAC_RADIO_DEFS_TBL_TXPWR_LAST_ENTRY])
   \                     ??macRadioSetTxPower_0:
   \   000025   8E82         MOV     DPL,R6
   \   000027   8F83         MOV     DPH,R7
   \   000029   A3           INC     DPTR
   \   00002A   E4           CLR     A
   \   00002B   93           MOVC    A,@A+DPTR
   \   00002C   F8           MOV     R0,A
   \   00002D   E5..         MOV     A,?V0 + 2
   \   00002F   C3           CLR     C
   \   000030   98           SUBB    A,R0
   \   000031   A2D2         MOV     C,0xD0 /* PSW */.2
   \   000033   65D0         XRL     A,PSW
   \   000035   33           RLC     A
   \   000036   5009         JNC     ??macRadioSetTxPower_1
    256            {
    257              /* smaller than the lowest power level -- out of table range */
    258              txPower = pTable[MAC_RADIO_DEFS_TBL_TXPWR_LAST_ENTRY];
   \   000038   8E82         MOV     DPL,R6
   \   00003A   8F83         MOV     DPH,R7
   \   00003C   A3           INC     DPTR
   \   00003D   E4           CLR     A
   \   00003E   93           MOVC    A,@A+DPTR
   \   00003F   F5..         MOV     ?V0 + 2,A
    259            }
    260          
    261            /*
    262             *  Set the global variable reqTxPower.  This variable is referenced
    263             *  by the function macRadioUpdateTxPower() to write the radio register.
    264             *
    265             *  A lookup table is used to translate the power level to the register
    266             *  value.
    267             */
    268            HAL_ENTER_CRITICAL_SECTION(s);
   \                     ??macRadioSetTxPower_1:
   \   000041   A2AF         MOV     C,0xa8.7
   \   000043   E4           CLR     A
   \   000044   33           RLC     A
   \   000045   F5..         MOV     ?V0 + 3,A
   \   000047   C2AF         CLR     0xa8.7
    269            /* When calculating index to the power register value table,
    270             * either txPower (of uint8 type) has to be explicitly type-casted to int8
    271             * or the subtraction expression has to be type-casted to uint8 to work
    272             * with the integral promotions.
    273             * The latter is more code size efficient and hence the latter is used.
    274             */
    275            {
    276              uint8 index = pTable[MAC_RADIO_DEFS_TBL_TXPWR_FIRST_ENTRY] - txPower
    277                + MAC_RADIO_DEFS_TBL_TXPWR_ENTRIES;
   \   000049   8E82         MOV     DPL,R6
   \   00004B   8F83         MOV     DPH,R7
   \   00004D   E4           CLR     A
   \   00004E   93           MOVC    A,@A+DPTR
   \   00004F   C3           CLR     C
   \   000050   95..         SUBB    A,?V0 + 2
   \   000052   2402         ADD     A,#0x2
   \   000054   F5..         MOV     ?V0 + 0,A
    278              reqTxPower = pTable[index];
   \   000056   75..00       MOV     ?V0 + 1,#0x0
   \   000059   EE           MOV     A,R6
   \   00005A   25..         ADD     A,?V0 + 0
   \   00005C   F582         MOV     DPL,A
   \   00005E   EF           MOV     A,R7
   \   00005F   35..         ADDC    A,?V0 + 1
   \   000061   F583         MOV     DPH,A
   \   000063   E4           CLR     A
   \   000064   93           MOVC    A,@A+DPTR
   \   000065   90....       MOV     DPTR,#reqTxPower
   \   000068   F0           MOVX    @DPTR,A
    279            }
    280            HAL_EXIT_CRITICAL_SECTION(s);
   \   000069   85....       MOV     ?V0 + 0,?V0 + 3
   \   00006C   E5..         MOV     A,?V0 + 3
   \   00006E   A2E0         MOV     C,0xE0 /* A   */.0
   \   000070   92AF         MOV     0xa8.7,C
    281          
    282            /* update the radio power setting */
    283            macRadioUpdateTxPower();
   \   000072                ; Setup parameters for call to function macRadioUpdateTxPower
   \   000072   12....       LCALL   ??macRadioUpdateTxPower?relay
    284          }
   \   000075   7F04         MOV     R7,#0x4
   \   000077   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   00007A                REQUIRE _A_IEN0
    285          
    286          #else
    287          /* - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - */
    288          
    289          MAC_INTERNAL_API void macRadioSetTxPower(uint8 txPower)
    290          {
    291            halIntState_t  s;
    292          
    293            /* same as above but with no lookup table, use raw register value */
    294            HAL_ENTER_CRITICAL_SECTION(s);
    295            reqTxPower = txPower;
    296            HAL_EXIT_CRITICAL_SECTION(s);
    297          
    298            /* update the radio power setting */
    299            macRadioUpdateTxPower();
    300          }
    301          
    302          #endif
    303          
    304          
    305          /**************************************************************************************************
    306           * @fn          macRadioUpdateTxPower
    307           *
    308           * @brief       Update the radio's transmit power if a new power level has been requested
    309           *
    310           * @param       reqTxPower - file scope variable that holds the last request power level
    311           *              macPhyTxPower - global variable that holds radio's set power level
    312           *
    313           * @return      none
    314           **************************************************************************************************
    315           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    316          MAC_INTERNAL_API void macRadioUpdateTxPower(void)
   \                     macRadioUpdateTxPower:
    317          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    318            halIntState_t  s;
    319          
    320            /*
    321             *  If the requested power setting is different from the actual radio setting,
    322             *  attempt to udpate to the new power setting.
    323             */
    324            HAL_ENTER_CRITICAL_SECTION(s);
   \   000004   A2AF         MOV     C,0xa8.7
   \   000006   E4           CLR     A
   \   000007   33           RLC     A
   \   000008   F9           MOV     R1,A
   \   000009   C2AF         CLR     0xa8.7
    325            if (reqTxPower != macPhyTxPower)
   \   00000B   90....       MOV     DPTR,#reqTxPower
   \   00000E   E0           MOVX    A,@DPTR
   \   00000F   F8           MOV     R0,A
   \   000010   90....       MOV     DPTR,#macPhyTxPower
   \   000013   E0           MOVX    A,@DPTR
   \   000014   68           XRL     A,R0
   \   000015   6024         JZ      ??macRadioUpdateTxPower_0
    326            {
    327              /*
    328               *  Radio power cannot be updated when the radio is physically transmitting.
    329               *  If there is a possibility radio is transmitting, do not change the power
    330               *  setting.  This function will be called again after the current transmit
    331               *  completes.
    332               */
    333              if (!macRxOutgoingAckFlag && !MAC_TX_IS_PHYSICALLY_ACTIVE())
   \   000017   90....       MOV     DPTR,#macRxOutgoingAckFlag
   \   00001A   E0           MOVX    A,@DPTR
   \   00001B   701E         JNZ     ??macRadioUpdateTxPower_0
   \   00001D   90....       MOV     DPTR,#macTxActive
   \   000020   E0           MOVX    A,@DPTR
   \   000021   A2E7         MOV     C,0xE0 /* A   */.7
   \   000023   4016         JC      ??macRadioUpdateTxPower_0
    334              {
    335                /*
    336                 *  Set new power level;  update the shadow value and write
    337                 *  the new value to the radio hardware.
    338                 */
    339                macPhyTxPower = reqTxPower;
   \   000025   90....       MOV     DPTR,#reqTxPower
   \   000028   E0           MOVX    A,@DPTR
   \   000029   90....       MOV     DPTR,#macPhyTxPower
   \   00002C   F0           MOVX    @DPTR,A
    340                macPhyTxPower=0xD5;
   \   00002D   90....       MOV     DPTR,#macPhyTxPower
   \   000030   74D5         MOV     A,#-0x2b
   \   000032   F0           MOVX    @DPTR,A
    341                MAC_RADIO_SET_TX_POWER(macPhyTxPower);
   \   000033   90....       MOV     DPTR,#macPhyTxPower
   \   000036   E0           MOVX    A,@DPTR
   \   000037   906190       MOV     DPTR,#0x6190
   \   00003A   F0           MOVX    @DPTR,A
    342              }
    343            }
    344            HAL_EXIT_CRITICAL_SECTION(s);
   \                     ??macRadioUpdateTxPower_0:
   \   00003B   E9           MOV     A,R1
   \   00003C   F8           MOV     R0,A
   \   00003D   E9           MOV     A,R1
   \   00003E   A2E0         MOV     C,0xE0 /* A   */.0
   \   000040   92AF         MOV     0xa8.7,C
    345          }
   \   000042   D083         POP     DPH
   \   000044   D082         POP     DPL
   \   000046   02....       LJMP    ?BRET
   \   000049                REQUIRE _A_IEN0
    346          
    347          
    348          /**************************************************************************************************
    349           * @fn          macRadioSetChannel
    350           *
    351           * @brief       Set radio channel.
    352           *
    353           * @param       channel - channel number, valid range is 11 through 26
    354           *
    355           * @return      none
    356           **************************************************************************************************
    357           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    358          MAC_INTERNAL_API void macRadioSetChannel(uint8 channel)
   \                     macRadioSetChannel:
    359          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    360            halIntState_t  s;
    361          
    362            MAC_ASSERT((channel >= 11) && (channel <= 28));  /* illegal channel */
   \   000007   EE           MOV     A,R6
   \   000008   C3           CLR     C
   \   000009   940B         SUBB    A,#0xb
   \   00000B   4006         JC      ??macRadioSetChannel_0
   \   00000D   EE           MOV     A,R6
   \   00000E   C3           CLR     C
   \   00000F   941D         SUBB    A,#0x1d
   \   000011   4003         JC      ??macRadioSetChannel_1
   \                     ??macRadioSetChannel_0:
   \   000013                ; Setup parameters for call to function halAssertHandler
   \   000013   12....       LCALL   ??halAssertHandler?relay
    363          
    364            /* critical section to make sure transmit does not start while updating channel */
    365            HAL_ENTER_CRITICAL_SECTION(s);
   \                     ??macRadioSetChannel_1:
   \   000016   A2AF         MOV     C,0xa8.7
   \   000018   E4           CLR     A
   \   000019   33           RLC     A
   \   00001A   FF           MOV     R7,A
   \   00001B   C2AF         CLR     0xa8.7
    366          
    367            /* set requested channel */
    368            reqChannel = channel;
   \   00001D   EE           MOV     A,R6
   \   00001E   90....       MOV     DPTR,#reqChannel
   \   000021   F0           MOVX    @DPTR,A
    369          
    370            /*
    371             *  If transmit is not active, update the radio hardware immediately.  If transmit is active,
    372             *  the channel will be updated at the end of the current transmit.
    373             */
    374            if (!macTxActive)
   \   000022   90....       MOV     DPTR,#macTxActive
   \   000025   E0           MOVX    A,@DPTR
   \   000026   7003         JNZ     ??macRadioSetChannel_2
    375            {
    376              macRadioUpdateChannel();
   \   000028                ; Setup parameters for call to function macRadioUpdateChannel
   \   000028   12....       LCALL   ??macRadioUpdateChannel?relay
    377            }
    378          
    379            HAL_EXIT_CRITICAL_SECTION(s);
   \                     ??macRadioSetChannel_2:
   \   00002B   EF           MOV     A,R7
   \   00002C   F8           MOV     R0,A
   \   00002D   EF           MOV     A,R7
   \   00002E   A2E0         MOV     C,0xE0 /* A   */.0
   \   000030   92AF         MOV     0xa8.7,C
    380          }
   \   000032   7F01         MOV     R7,#0x1
   \   000034   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   000037                REQUIRE _A_IEN0
    381          
    382          
    383          /**************************************************************************************************
    384           * @fn          macRadioUpdateChannel
    385           *
    386           * @brief       Update the radio channel if a new channel has been requested.
    387           *
    388           * @param       none
    389           *
    390           * @return      none
    391           **************************************************************************************************
    392           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    393          MAC_INTERNAL_API void macRadioUpdateChannel(void)
   \                     macRadioUpdateChannel:
    394          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    395            halIntState_t  s;
    396          
    397            MAC_ASSERT(!macTxActive); /* cannot change channel during a transmit */
   \   000005   90....       MOV     DPTR,#macTxActive
   \   000008   E0           MOVX    A,@DPTR
   \   000009   6003         JZ      ??macRadioUpdateChannel_0
   \   00000B                ; Setup parameters for call to function halAssertHandler
   \   00000B   12....       LCALL   ??halAssertHandler?relay
    398          
    399            /* if the channel has changed, set the radio to the new channel */
    400            HAL_ENTER_CRITICAL_SECTION(s);
   \                     ??macRadioUpdateChannel_0:
   \   00000E   A2AF         MOV     C,0xa8.7
   \   000010   E4           CLR     A
   \   000011   33           RLC     A
   \   000012   FE           MOV     R6,A
   \   000013   C2AF         CLR     0xa8.7
    401            if (reqChannel != macPhyChannel)
   \   000015   90....       MOV     DPTR,#reqChannel
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F8           MOV     R0,A
   \   00001A   90....       MOV     DPTR,#macPhyChannel
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   68           XRL     A,R0
   \   00001F   6028         JZ      ??macRadioUpdateChannel_1
    402            {
    403              macPhyChannel = reqChannel;
   \   000021   90....       MOV     DPTR,#reqChannel
   \   000024   E0           MOVX    A,@DPTR
   \   000025   90....       MOV     DPTR,#macPhyChannel
   \   000028   F0           MOVX    @DPTR,A
    404              HAL_EXIT_CRITICAL_SECTION(s);
   \   000029   EE           MOV     A,R6
   \   00002A   FF           MOV     R7,A
   \   00002B   EE           MOV     A,R6
   \   00002C   A2E0         MOV     C,0xE0 /* A   */.0
   \   00002E   92AF         MOV     0xa8.7,C
    405          
    406              /* changing the channel stops any receive in progress */
    407              macRxOff();
   \   000030                ; Setup parameters for call to function macRxOff
   \   000030   12....       LCALL   ??macRxOff?relay
    408              MAC_RADIO_SET_CHANNEL(macPhyChannel);
   \   000033   75F005       MOV     B,#0x5
   \   000036   90....       MOV     DPTR,#macPhyChannel
   \   000039   E0           MOVX    A,@DPTR
   \   00003A   A4           MUL     AB
   \   00003B   24D4         ADD     A,#-0x2c
   \   00003D   90618F       MOV     DPTR,#0x618f
   \   000040   F0           MOVX    @DPTR,A
    409          
    410              /* If the channel is updated in the middle of receiving a frame, we must
    411               * clean up the Rx logic.
    412               */
    413              macRxHaltCleanup();
   \   000041                ; Setup parameters for call to function macRxHaltCleanup
   \   000041   12....       LCALL   ??macRxHaltCleanup?relay
    414          
    415              macRxOnRequest();
   \   000044                ; Setup parameters for call to function macRxOnRequest
   \   000044   12....       LCALL   ??macRxOnRequest?relay
   \   000047   8007         SJMP    ??macRadioUpdateChannel_2
    416            }
    417            else
    418            {
    419              HAL_EXIT_CRITICAL_SECTION(s);
   \                     ??macRadioUpdateChannel_1:
   \   000049   EE           MOV     A,R6
   \   00004A   F8           MOV     R0,A
   \   00004B   EE           MOV     A,R6
   \   00004C   A2E0         MOV     C,0xE0 /* A   */.0
   \   00004E   92AF         MOV     0xa8.7,C
    420            }
    421          }
   \                     ??macRadioUpdateChannel_2:
   \   000050   7F01         MOV     R7,#0x1
   \   000052   02....       LJMP    ?BANKED_LEAVE_XDATA
   \   000055                REQUIRE _A_IEN0
    422          
    423          
    424          /**************************************************************************************************
    425           * @fn          macRadioStartScan
    426           *
    427           * @brief       Puts radio into selected scan mode.
    428           *
    429           * @param       scanMode - scan mode, see #defines in .h file
    430           *
    431           * @return      none
    432           **************************************************************************************************
    433           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    434          MAC_INTERNAL_API void macRadioStartScan(uint8 scanMode)
   \                     macRadioStartScan:
    435          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    436            MAC_ASSERT(macSleepState == MAC_SLEEP_STATE_AWAKE); /* radio must be awake */
   \   000007   90....       MOV     DPTR,#macSleepState
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   6003         JZ      ??macRadioStartScan_0
   \   00000D                ; Setup parameters for call to function halAssertHandler
   \   00000D   12....       LCALL   ??halAssertHandler?relay
    437            MAC_ASSERT(macRxFilter == RX_FILTER_OFF); /* all filtering must be off to start scan */
   \                     ??macRadioStartScan_0:
   \   000010   90....       MOV     DPTR,#macRxFilter
   \   000013   E0           MOVX    A,@DPTR
   \   000014   6003         JZ      ??macRadioStartScan_1
   \   000016                ; Setup parameters for call to function halAssertHandler
   \   000016   12....       LCALL   ??halAssertHandler?relay
    438          
    439            /* set the receive filter based on the selected scan mode */
    440            if (scanMode == MAC_SCAN_ED)
   \                     ??macRadioStartScan_1:
   \   000019   EE           MOV     A,R6
   \   00001A   7008         JNZ     ??macRadioStartScan_2
    441            {
    442              macRxFilter = RX_FILTER_ALL;
   \   00001C   90....       MOV     DPTR,#macRxFilter
   \   00001F   7401         MOV     A,#0x1
   \   000021   F0           MOVX    @DPTR,A
   \   000022   802C         SJMP    ??macRadioStartScan_3
    443            }
    444            else if (scanMode == MAC_SCAN_ORPHAN)
   \                     ??macRadioStartScan_2:
   \   000024   7403         MOV     A,#0x3
   \   000026   6E           XRL     A,R6
   \   000027   7008         JNZ     ??macRadioStartScan_4
    445            {
    446              macRxFilter = RX_FILTER_NON_COMMAND_FRAMES;
   \   000029   90....       MOV     DPTR,#macRxFilter
   \   00002C   7403         MOV     A,#0x3
   \   00002E   F0           MOVX    @DPTR,A
   \   00002F   801F         SJMP    ??macRadioStartScan_3
    447            }
    448            else
    449            {
    450              MAC_ASSERT((scanMode == MAC_SCAN_ACTIVE) || (scanMode == MAC_SCAN_PASSIVE)); /* invalid scan type */
   \                     ??macRadioStartScan_4:
   \   000031   7401         MOV     A,#0x1
   \   000033   6E           XRL     A,R6
   \   000034   6008         JZ      ??macRadioStartScan_5
   \   000036   7402         MOV     A,#0x2
   \   000038   6E           XRL     A,R6
   \   000039   6003         JZ      ??macRadioStartScan_5
   \   00003B                ; Setup parameters for call to function halAssertHandler
   \   00003B   12....       LCALL   ??halAssertHandler?relay
    451              macRxFilter = RX_FILTER_NON_BEACON_FRAMES;
   \                     ??macRadioStartScan_5:
   \   00003E   90....       MOV     DPTR,#macRxFilter
   \   000041   7402         MOV     A,#0x2
   \   000043   F0           MOVX    @DPTR,A
    452          
    453              /* for active and passive scans, per spec the pan ID must be 0xFFFF */
    454              MAC_RADIO_SET_PAN_ID(0xFFFF);
   \   000044   906172       MOV     DPTR,#0x6172
   \   000047   74FF         MOV     A,#-0x1
   \   000049   F0           MOVX    @DPTR,A
   \   00004A   906173       MOV     DPTR,#0x6173
   \   00004D   74FF         MOV     A,#-0x1
   \   00004F   F0           MOVX    @DPTR,A
    455            }
    456          }
   \                     ??macRadioStartScan_3:
   \   000050   7F01         MOV     R7,#0x1
   \   000052   02....       LJMP    ?BANKED_LEAVE_XDATA
    457          
    458          
    459          /**************************************************************************************************
    460           * @fn          macRadioStopScan
    461           *
    462           * @brief       Takes radio out of scan mode.  Note can be called if
    463           *
    464           * @param       none
    465           *
    466           * @return      none
    467           **************************************************************************************************
    468           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    469          MAC_INTERNAL_API void macRadioStopScan(void)
   \                     macRadioStopScan:
    470          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    471            macRxFilter = RX_FILTER_OFF;
   \   000004   90....       MOV     DPTR,#macRxFilter
   \   000007   7400         MOV     A,#0x0
   \   000009   F0           MOVX    @DPTR,A
    472          
    473            /* restore the pan ID (passive and active scans set pan ID to 0xFFFF) */
    474            MAC_RADIO_SET_PAN_ID(macPib.panId);
   \   00000A   90....       MOV     DPTR,#macPib + 29
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   F8           MOV     R0,A
   \   00000F   A3           INC     DPTR
   \   000010   E0           MOVX    A,@DPTR
   \   000011   F9           MOV     R1,A
   \   000012   E8           MOV     A,R0
   \   000013   906172       MOV     DPTR,#0x6172
   \   000016   F0           MOVX    @DPTR,A
   \   000017   90....       MOV     DPTR,#macPib + 29
   \   00001A   E0           MOVX    A,@DPTR
   \   00001B   F8           MOV     R0,A
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   F9           MOV     R1,A
   \   00001F   E4           CLR     A
   \   000020   E9           MOV     A,R1
   \   000021   F8           MOV     R0,A
   \   000022   906173       MOV     DPTR,#0x6173
   \   000025   F0           MOVX    @DPTR,A
    475          }
   \   000026   D083         POP     DPH
   \   000028   D082         POP     DPL
   \   00002A   02....       LJMP    ?BRET
    476          
    477          
    478          /**************************************************************************************************
    479           * @fn          macRadioEnergyDetectStart
    480           *
    481           * @brief       Initiates energy detect.  The highest energy detected is recorded from the time
    482           *              when this function is called until the energy detect is stopped.
    483           *
    484           * @param       none
    485           *
    486           * @return      none
    487           **************************************************************************************************
    488           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    489          void macRadioEnergyDetectStart(void)
   \                     macRadioEnergyDetectStart:
    490          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    491            MAC_RADIO_RECORD_MAX_RSSI_START();
   \   000004                ; Setup parameters for call to function macMcuRecordMaxRssiStart
   \   000004   12....       LCALL   ??macMcuRecordMaxRssiStart?relay
    492          }
   \   000007   D083         POP     DPH
   \   000009   D082         POP     DPL
   \   00000B   02....       LJMP    ?BRET
    493          
    494          
    495          /**************************************************************************************************
    496           * @fn          macRadioEnergyDetectStop
    497           *
    498           * @brief       Called at completion of an energy detect.  Note: can be called even if energy
    499           *              detect is already stopped (needed by reset).
    500           *
    501           * @param       none
    502           *
    503           * @return      highest energy detect measurement
    504           **************************************************************************************************
    505           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    506          uint8 macRadioEnergyDetectStop(void)
   \                     macRadioEnergyDetectStop:
    507          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    508            uint8 rssiDbm;
    509            uint8 energyDetectMeasurement;
    510          
    511            rssiDbm = MAC_RADIO_RECORD_MAX_RSSI_STOP() + MAC_RADIO_RSSI_OFFSET;
   \   000005                ; Setup parameters for call to function macMcuRecordMaxRssiStop
   \   000005   12....       LCALL   ??macMcuRecordMaxRssiStop?relay
   \   000008   E9           MOV     A,R1
   \   000009   24B7         ADD     A,#-0x49
   \   00000B   FF           MOV     R7,A
    512            MAC_RADIO_RSSI_LNA_OFFSET(rssiDbm);
    513            energyDetectMeasurement = radioComputeED(rssiDbm);
   \   00000C                ; Setup parameters for call to function radioComputeED
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??radioComputeED?relay
   \   000010   E9           MOV     A,R1
   \   000011   FE           MOV     R6,A
    514          
    515            return(energyDetectMeasurement);
   \   000012   F9           MOV     R1,A
   \   000013   7F01         MOV     R7,#0x1
   \   000015   02....       LJMP    ?BANKED_LEAVE_XDATA
    516          }
    517          
    518          /*=================================================================================================
    519           * @fn          radioComputeED
    520           *
    521           * @brief       Compute energy detect measurement.
    522           *
    523           * @param       rssi - raw RSSI value from radio hardware
    524           *
    525           * @return      energy detect measurement in the range of 0x00-0xFF
    526           *=================================================================================================
    527           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    528          static uint8 radioComputeED(int8 rssiDbm)
   \                     radioComputeED:
    529          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   \   000000   E9           MOV     A,R1
   \   000001   FD           MOV     R5,A
    530            uint8 ed;
    531          
    532            /*
    533             *  Keep RF power between minimum and maximum values.
    534             *  This min/max range is derived from datasheet and specification.
    535             */
    536            if (rssiDbm < ED_RF_POWER_MIN_DBM)
   \   000002   ED           MOV     A,R5
   \   000003   C3           CLR     C
   \   000004   94AF         SUBB    A,#-0x51
   \   000006   A2D2         MOV     C,0xD0 /* PSW */.2
   \   000008   65D0         XRL     A,PSW
   \   00000A   33           RLC     A
   \   00000B   5004         JNC     ??radioComputeED_0
    537            {
    538              rssiDbm = ED_RF_POWER_MIN_DBM;
   \   00000D   7DAF         MOV     R5,#-0x51
   \   00000F   800D         SJMP    ??radioComputeED_1
    539            }
    540            else if (rssiDbm > ED_RF_POWER_MAX_DBM)
   \                     ??radioComputeED_0:
   \   000011   ED           MOV     A,R5
   \   000012   C3           CLR     C
   \   000013   940B         SUBB    A,#0xb
   \   000015   A2D2         MOV     C,0xD0 /* PSW */.2
   \   000017   65D0         XRL     A,PSW
   \   000019   33           RLC     A
   \   00001A   4002         JC      ??radioComputeED_1
    541            {
    542              rssiDbm = ED_RF_POWER_MAX_DBM;
   \   00001C   7D0A         MOV     R5,#0xa
    543            }
    544          
    545            /*
    546             *  Create energy detect measurement by normalizing and scaling RF power level.
    547             *
    548             *  Note : The division operation below is designed for maximum accuracy and
    549             *         best granularity.  This is done by grouping the math operations to
    550             *         compute the entire numerator before doing any division.
    551             */
    552            ed = (MAC_SPEC_ED_MAX * (rssiDbm - ED_RF_POWER_MIN_DBM)) / (ED_RF_POWER_MAX_DBM - ED_RF_POWER_MIN_DBM);
   \                     ??radioComputeED_1:
   \   00001E   ED           MOV     A,R5
   \   00001F   F8           MOV     R0,A
   \   000020   33           RLC     A
   \   000021   95E0         SUBB    A,0xE0 /* A   */
   \   000023   F9           MOV     R1,A
   \   000024   E8           MOV     A,R0
   \   000025   2451         ADD     A,#0x51
   \   000027   F8           MOV     R0,A
   \   000028   E9           MOV     A,R1
   \   000029   3400         ADDC    A,#0x0
   \   00002B   F9           MOV     R1,A
   \   00002C   E8           MOV     A,R0
   \   00002D   75F0FF       MOV     B,#-0x1
   \   000030   A4           MUL     AB
   \   000031   C8           XCH     A,R0
   \   000032   AAF0         MOV     R2,B
   \   000034   75F000       MOV     B,#0x0
   \   000037   A4           MUL     AB
   \   000038   2A           ADD     A,R2
   \   000039   FA           MOV     R2,A
   \   00003A   75F0FF       MOV     B,#-0x1
   \   00003D   E9           MOV     A,R1
   \   00003E   A4           MUL     AB
   \   00003F   2A           ADD     A,R2
   \   000040   F9           MOV     R1,A
   \   000041   7A5B         MOV     R2,#0x5b
   \   000043   7B00         MOV     R3,#0x0
   \   000045   12....       LCALL   ?S_DIV_MOD
   \   000048   E8           MOV     A,R0
   \   000049   FC           MOV     R4,A
    553          
    554            return(ed);
   \   00004A   F9           MOV     R1,A
   \   00004B   02....       LJMP    ?BRET
    555          }
    556          
    557          
    558          /**************************************************************************************************
    559           * @fn          macRadioComputeLQI
    560           *
    561           * @brief       Compute link quality indication.
    562           *
    563           * @param       rssi - raw RSSI value from radio hardware
    564           *              corr - correlation value from radio hardware
    565           *
    566           * @return      link quality indicator value
    567           **************************************************************************************************
    568           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    569          MAC_INTERNAL_API uint8 macRadioComputeLQI(int8 rssiDbm, uint8 corr)
   \                     macRadioComputeLQI:
    570          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   \   000007   EA           MOV     A,R2
   \   000008   FF           MOV     R7,A
    571            (void) corr; /* suppress compiler warning of unused parameter */
    572          
    573            /*
    574             *  Note : Currently the LQI value is simply the energy detect measurement.
    575             *         A more accurate value could be derived by using the correlation
    576             *         value along with the RSSI value.
    577             */
    578            return(radioComputeED(rssiDbm));
   \   000009                ; Setup parameters for call to function radioComputeED
   \   000009   EE           MOV     A,R6
   \   00000A   F9           MOV     R1,A
   \   00000B   12....       LCALL   ??radioComputeED?relay
   \   00000E   7F01         MOV     R7,#0x1
   \   000010   02....       LJMP    ?BANKED_LEAVE_XDATA
    579          }

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRadioInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRadioInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRadioReset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRadioReset

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRadioRandomByte?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRadioRandomByte

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRadioSetPanCoordinator?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRadioSetPanCoordinator

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRadioSetPanID?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRadioSetPanID

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRadioSetShortAddr?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRadioSetShortAddr

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRadioSetIEEEAddr?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRadioSetIEEEAddr

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRadioSetTxPower?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRadioSetTxPower

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRadioUpdateTxPower?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRadioUpdateTxPower

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRadioSetChannel?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRadioSetChannel

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRadioUpdateChannel?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRadioUpdateChannel

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRadioStartScan?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRadioStartScan

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRadioStopScan?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRadioStopScan

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRadioEnergyDetectStart?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRadioEnergyDetectStart

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRadioEnergyDetectStop?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRadioEnergyDetectStop

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??radioComputeED?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    radioComputeED

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macRadioComputeLQI?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macRadioComputeLQI
    580          
    581          
    582          /**************************************************************************************************
    583          */

   Maximum stack usage in bytes:

   ISTACK PSTACK XSTACK Function
   ------ ------ ------ --------
       0      0      9  macRadioComputeLQI
                          0 0  9 -> radioComputeED
       2      0      0  macRadioEnergyDetectStart
                          2 0  0 -> macMcuRecordMaxRssiStart
       0      0      9  macRadioEnergyDetectStop
                          0 0  9 -> macMcuRecordMaxRssiStop
                          0 0  9 -> radioComputeED
       2      0      0  macRadioInit
       2      0      0  macRadioRandomByte
                          2 0  0 -> macMcuRandomByte
       2      0      0  macRadioReset
                          2 0  0 -> macRadioEnergyDetectStop
                          2 0  0 -> macRadioStopScan
       0      0      9  macRadioSetChannel
                          0 0  9 -> halAssertHandler
                          0 0  9 -> macRadioUpdateChannel
       0      0      9  macRadioSetIEEEAddr
                          0 0  9 -> macMemWriteRam
       0      0      9  macRadioSetPanCoordinator
       2      0      0  macRadioSetPanID
       2      0      0  macRadioSetShortAddr
       0      0     12  macRadioSetTxPower
                          0 0 12 -> macRadioUpdateTxPower
       0      0      9  macRadioStartScan
                          0 0  9 -> halAssertHandler
       2      0      0  macRadioStopScan
       0      0     18  macRadioUpdateChannel
                          0 0  9 -> halAssertHandler
                          0 0  9 -> macRxHaltCleanup
                          0 0  9 -> macRxOff
                          0 0  9 -> macRxOnRequest
       2      0     12  macRadioUpdateTxPower
       0      0      9  radioComputeED


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
       6  ??macRadioComputeLQI?relay
       6  ??macRadioEnergyDetectStart?relay
       6  ??macRadioEnergyDetectStop?relay
       6  ??macRadioInit?relay
       6  ??macRadioRandomByte?relay
       6  ??macRadioReset?relay
       6  ??macRadioSetChannel?relay
       6  ??macRadioSetIEEEAddr?relay
       6  ??macRadioSetPanCoordinator?relay
       6  ??macRadioSetPanID?relay
       6  ??macRadioSetShortAddr?relay
       6  ??macRadioSetTxPower?relay
       6  ??macRadioStartScan?relay
       6  ??macRadioStopScan?relay
       6  ??macRadioUpdateChannel?relay
       6  ??macRadioUpdateTxPower?relay
       6  ??radioComputeED?relay
       1  _A_IEN0
       1  macPhyChannel
       1  macPhyTxPower
      19  macRadioComputeLQI
      14  macRadioEnergyDetectStart
      24  macRadioEnergyDetectStop
      35  macRadioInit
      14  macRadioRandomByte
      18  macRadioReset
      55  macRadioSetChannel
      27  macRadioSetIEEEAddr
      41  macRadioSetPanCoordinator
      27  macRadioSetPanID
      27  macRadioSetShortAddr
     122  macRadioSetTxPower
      85  macRadioStartScan
      45  macRadioStopScan
      85  macRadioUpdateChannel
      73  macRadioUpdateTxPower
      78  radioComputeED
       1  reqChannel
       1  reqTxPower

 
 789 bytes in segment BANKED_CODE
 102 bytes in segment BANK_RELAYS
   1 byte  in segment SFR_AN
   4 bytes in segment XDATA_Z
 
 891 bytes of CODE  memory
   0 bytes of DATA  memory (+ 1 byte shared)
   4 bytes of XDATA memory

Errors: none
Warnings: none
