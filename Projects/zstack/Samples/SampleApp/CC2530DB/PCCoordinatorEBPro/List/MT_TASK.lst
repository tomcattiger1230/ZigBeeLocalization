###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.20.2.41139 for 8051             05/Jan/2016  16:14:34 #
# Copyright 2004-2013 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#                                                                             #
#    Source file        =  C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Comp #
#                          onents\mt\MT_TASK.c                                #
#    Command line       =  -f C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\P #
#                          rojects\zstack\Samples\SampleApp\CC2530DB\..\..\.. #
#                          \Tools\CC2530DB\f8wCoord.cfg (-DCPU32MHZ           #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DZDO_COORDINATOR -DRTR_NWK -DBLINK_LEDS) -f     #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\To #
#                          ols\CC2530DB\f8wConfig.cfg (-DSECURE=0             #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFF1                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=TRUE      #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Comp #
#                          onents\mt\MT_TASK.c -D ZIGBEEPRO -D ZTOOL_P1 -D    #
#                          xMT_TASK -D xMT_SYS_FUNC -D xMT_ZDO_FUNC -D        #
#                          LCD_SUPPORTED=DEBUG -lC C:\Users\ArnoldWorkStation #
#                          \Desktop\ZigbeeTest\Projects\zstack\Samples\Sample #
#                          App\CC2530DB\PCCoordinatorEBPro\List\ -lA          #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\PCCoordinat #
#                          orEBPro\List\ --diag_suppress Pe001,Pa010 -o       #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\PCCoordinat #
#                          orEBPro\Obj\ -e --no_cse --no_unroll --no_inline   #
#                          --no_code_motion --no_tbaa --debug --core=plain    #
#                          --dptr=16,1 --data_model=large                     #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I C:\Users\ArnoldWorkStation #
#                          \Desktop\ZigbeeTest\Projects\zstack\Samples\Sample #
#                          App\CC2530DB\ -I C:\Users\ArnoldWorkStation\Deskto #
#                          p\ZigbeeTest\Projects\zstack\Samples\SampleApp\CC2 #
#                          530DB\..\SOURCE\ -I C:\Users\ArnoldWorkStation\Des #
#                          ktop\ZigbeeTest\Projects\zstack\Samples\SampleApp\ #
#                          CC2530DB\..\..\..\ZMAIN\TI2530DB\ -I               #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\MT\ -I C:\Users\ArnoldWorkStation\D #
#                          esktop\ZigbeeTest\Projects\zstack\Samples\SampleAp #
#                          p\CC2530DB\..\..\..\..\..\COMPONENTS\HAL\INCLUDE\  #
#                          -I C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\P #
#                          rojects\zstack\Samples\SampleApp\CC2530DB\..\..\.. #
#                          \..\..\COMPONENTS\HAL\TARGET\CC2530EB\ -I          #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\OSAL\MCU\CCSOC\ -I                  #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\OSAL\INCLUDE\ -I                    #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\STACK\AF\ -I                        #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\STACK\NWK\ -I                       #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\STACK\SEC\ -I                       #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\STACK\SAPI\ -I                      #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\STACK\SYS\ -I                       #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\STACK\ZDO\ -I                       #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\ZMAC\F8W\ -I                        #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\ZMAC\ -I C:\Users\ArnoldWorkStation #
#                          \Desktop\ZigbeeTest\Projects\zstack\Samples\Sample #
#                          App\CC2530DB\..\..\..\..\..\COMPONENTS\SERVICES\SA #
#                          DDR\ -I C:\Users\ArnoldWorkStation\Desktop\ZigbeeT #
#                          est\Projects\zstack\Samples\SampleApp\CC2530DB\..\ #
#                          ..\..\..\..\COMPONENTS\SERVICES\SDATA\ -I          #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\MAC\INCLUDE\ -I                     #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\MAC\HIGH_LEVEL\ -I                  #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\MAC\LOW_LEVEL\srf04\ -I             #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\MAC\LOW_LEVEL\srf04\SINGLE_CHIP\    #
#                          -On --require_prototypes                           #
#    List file          =  C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\PCCoordinat #
#                          orEBPro\List\MT_TASK.lst                           #
#    Object file        =  C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\PCCoordinat #
#                          orEBPro\Obj\MT_TASK.r51                            #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Components\mt\MT_TASK.c
      1          /***************************************************************************************************
      2            Filename:       MT_TASK.c
      3            Revised:        $Date: 2009-11-09 20:03:17 -0800 (Mon, 09 Nov 2009) $
      4            Revision:       $Revision: 21106 $
      5          
      6            Description:    MonitorTest Task handling routines
      7          
      8            Copyright 2007 Texas Instruments Incorporated. All rights reserved.
      9          
     10            IMPORTANT: Your use of this Software is limited to those specific rights
     11            granted under the terms of a software license agreement between the user
     12            who downloaded the software, his/her employer (which must be your employer)
     13            and Texas Instruments Incorporated (the "License").  You may not use this
     14            Software unless you agree to abide by the terms of the License. The License
     15            limits your use, and you acknowledge, that the Software may not be modified,
     16            copied or distributed unless embedded on a Texas Instruments microcontroller
     17            or used solely and exclusively in conjunction with a Texas Instruments radio
     18            frequency transceiver, which is integrated into your product.  Other than for
     19            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     20            works of, modify, distribute, perform, display or sell this Software and/or
     21            its documentation for any purpose.
     22          
     23            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     24            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     25            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     26            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     27            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     28            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     29            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     30            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     31            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     32            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     33            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     34          
     35            Should you have any questions regarding your right to use this Software,
     36            contact Texas Instruments Incorporated at www.TI.com.
     37          
     38           ***************************************************************************************************/
     39          
     40          /***************************************************************************************************
     41           * INCLUDES
     42           ***************************************************************************************************/
     43          #include "ZComDef.h"
     44          #include "MT_TASK.h"
     45          #include "MT.h"
     46          #include "MT_DEBUG.h"
     47          #include "MT_UART.h"
     48          #include "MT_UTIL.h"
     49          #include "MT_SYS.h"
     50          #include "MT_ZDO.h"
     51          
     52          #include "hal_uart.h"
     53          
     54          #include "OSAL_Memory.h"
     55          
     56          /***************************************************************************************************
     57           * LOCAL FUNCTIONS
     58           ***************************************************************************************************/
     59          void MT_ProcessIncomingCommand( mtOSALSerialData_t *msg );
     60          
     61          /***************************************************************************************************
     62           * GLOBALS
     63           ***************************************************************************************************/
     64          
     65          /***************************************************************************************************
     66           * @fn      MT_TaskInit
     67           *
     68           * @brief  MonitorTest Task Initialization.  This function is put into the
     69           *         task table.
     70           *
     71           * @param   byte task_id - task ID of the MT Task
     72           *
     73           * @return  void
     74           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     75          void MT_TaskInit(uint8 task_id)
   \                     MT_TaskInit:
     76          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
     77            /* Initialize the Serial port */
     78            MT_UartInit();
   \   000007                ; Setup parameters for call to function MT_UartInit
   \   000007   12....       LCALL   ??MT_UartInit?relay
     79          
     80            /* Register taskID - Do this after UartInit() because it will reset the taskID */
     81            MT_UartRegisterTaskID(task_id);
   \   00000A                ; Setup parameters for call to function MT_UartRegisterTaskID
   \   00000A   EE           MOV     A,R6
   \   00000B   F9           MOV     R1,A
   \   00000C   12....       LCALL   ??MT_UartRegisterTaskID?relay
     82          
     83            /* Initialize MT */
     84            MT_Init(task_id);
   \   00000F                ; Setup parameters for call to function MT_Init
   \   00000F   EE           MOV     A,R6
   \   000010   F9           MOV     R1,A
   \   000011   12....       LCALL   ??MT_Init?relay
     85          }
   \   000014   7F01         MOV     R7,#0x1
   \   000016   02....       LJMP    ?BANKED_LEAVE_XDATA
     86          
     87          /***************************************************************************************************
     88           * @fn      MT_ProcessEvent
     89           *
     90           * @brief MonitorTest Task Event Processor.  This task is put into the task table.
     91           *
     92           * @param   byte task_id - task ID of the MT Task
     93           * @param   UINT16 events - event(s) for the MT Task
     94           *
     95           * @return  void
     96           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     97          UINT16 MT_ProcessEvent(uint8 task_id, uint16 events)
   \                     MT_ProcessEvent:
     98          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 2,R1
   \   000007   EA           MOV     A,R2
   \   000008   FE           MOV     R6,A
   \   000009   EB           MOV     A,R3
   \   00000A   FF           MOV     R7,A
     99            uint8 *msg_ptr;
    100            
    101            (void)task_id;  // Intentionally unreferenced parameter
    102          
    103            /* Could be multiple events, so switch won't work */
    104            if ( events & SYS_EVENT_MSG )
   \   00000B   EE           MOV     A,R6
   \   00000C   5400         ANL     A,#0x0
   \   00000E   F8           MOV     R0,A
   \   00000F   EF           MOV     A,R7
   \   000010   5480         ANL     A,#0x80
   \   000012   F9           MOV     R1,A
   \   000013   E8           MOV     A,R0
   \   000014   49           ORL     A,R1
   \   000015   602B         JZ      ??MT_ProcessEvent_0
    105            {
    106              while ( (msg_ptr = osal_msg_receive( MT_TaskID )) )
   \                     ??MT_ProcessEvent_1:
   \   000017                ; Setup parameters for call to function osal_msg_receive
   \   000017   90....       MOV     DPTR,#MT_TaskID
   \   00001A   E0           MOVX    A,@DPTR
   \   00001B   F9           MOV     R1,A
   \   00001C   12....       LCALL   ??osal_msg_receive?relay
   \   00001F   8A..         MOV     ?V0 + 4,R2
   \   000021   8B..         MOV     ?V0 + 5,R3
   \   000023   A8..         MOV     R0,?V0 + 4
   \   000025   A9..         MOV     R1,?V0 + 5
   \   000027   88..         MOV     ?V0 + 0,R0
   \   000029   89..         MOV     ?V0 + 1,R1
   \   00002B   E8           MOV     A,R0
   \   00002C   49           ORL     A,R1
   \   00002D   6009         JZ      ??MT_ProcessEvent_2
    107              {
    108                MT_ProcessIncomingCommand((mtOSALSerialData_t *)msg_ptr);
   \   00002F                ; Setup parameters for call to function MT_ProcessIncomingCommand
   \   00002F   AA..         MOV     R2,?V0 + 0
   \   000031   AB..         MOV     R3,?V0 + 1
   \   000033   12....       LCALL   ??MT_ProcessIncomingCommand?relay
   \   000036   80DF         SJMP    ??MT_ProcessEvent_1
    109              }
    110          
    111              /* Return unproccessed events */
    112              return (events ^ SYS_EVENT_MSG);
   \                     ??MT_ProcessEvent_2:
   \   000038   EE           MOV     A,R6
   \   000039   6400         XRL     A,#0x0
   \   00003B   FA           MOV     R2,A
   \   00003C   EF           MOV     A,R7
   \   00003D   6480         XRL     A,#0x80
   \   00003F   FB           MOV     R3,A
   \   000040   8013         SJMP    ??MT_ProcessEvent_3
    113            }
    114          
    115            if ( events & MT_ZTOOL_SERIAL_RCV_BUFFER_FULL )
   \                     ??MT_ProcessEvent_0:
   \   000042   EE           MOV     A,R6
   \   000043   5404         ANL     A,#0x4
   \   000045   600A         JZ      ??MT_ProcessEvent_4
    116            {
    117              /* Return unproccessed events */
    118              return (events ^ MT_ZTOOL_SERIAL_RCV_BUFFER_FULL);
   \   000047   EE           MOV     A,R6
   \   000048   6404         XRL     A,#0x4
   \   00004A   FA           MOV     R2,A
   \   00004B   EF           MOV     A,R7
   \   00004C   6400         XRL     A,#0x0
   \   00004E   FB           MOV     R3,A
   \   00004F   8004         SJMP    ??MT_ProcessEvent_3
    119            }
    120          
    121            /* Handle MT_SYS_OSAL_START_TIMER callbacks */
    122          #if defined MT_SYS_FUNC
    123            if ( events & (MT_SYS_OSAL_EVENT_MASK))
    124            {
    125              if (events & MT_SYS_OSAL_EVENT_0)
    126              {
    127                MT_SysOsalTimerExpired(0x00);
    128                events ^= MT_SYS_OSAL_EVENT_0;
    129              }
    130          
    131              if (events & MT_SYS_OSAL_EVENT_1)
    132              {
    133                MT_SysOsalTimerExpired(0x01);
    134                events ^= MT_SYS_OSAL_EVENT_1;
    135              }
    136          
    137              if (events & MT_SYS_OSAL_EVENT_2)
    138              {
    139                MT_SysOsalTimerExpired(0x02);
    140                events ^= MT_SYS_OSAL_EVENT_2;
    141              }
    142          
    143              if (events & MT_SYS_OSAL_EVENT_3)
    144              {
    145                MT_SysOsalTimerExpired(0x03);
    146                events ^= MT_SYS_OSAL_EVENT_3;
    147              }
    148          
    149              return events;
    150            }
    151          #endif
    152          
    153            /* Discard or make more handlers */
    154            return 0;
   \                     ??MT_ProcessEvent_4:
   \   000051   7A00         MOV     R2,#0x0
   \   000053   7B00         MOV     R3,#0x0
   \                     ??MT_ProcessEvent_3:
   \   000055   7F06         MOV     R7,#0x6
   \   000057   02....       LJMP    ?BANKED_LEAVE_XDATA
    155          
    156          } /* MT_ProcessEvent() */
    157          
    158          /***************************************************************************************************
    159           * @fn      MT_ProcessIncomingCommand
    160           *
    161           * @brief
    162           *
    163           *   Process Event Messages.
    164           *
    165           * @param   byte *msg - pointer to event message
    166           *
    167           * @return
    168           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    169          void MT_ProcessIncomingCommand( mtOSALSerialData_t *msg )
   \                     MT_ProcessIncomingCommand:
    170          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    171            byte deallocate;
    172            byte *msg_ptr;
    173            byte len;
    174          
    175            /* A little setup for AF, CB_FUNC and MT_SYS_APP_RSP_MSG */
    176            msg_ptr = msg->msg;
   \   000009   8E82         MOV     DPL,R6
   \   00000B   8F83         MOV     DPH,R7
   \   00000D   A3           INC     DPTR
   \   00000E   A3           INC     DPTR
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   F8           MOV     R0,A
   \   000011   A3           INC     DPTR
   \   000012   E0           MOVX    A,@DPTR
   \   000013   F9           MOV     R1,A
   \   000014   88..         MOV     ?V0 + 0,R0
   \   000016   89..         MOV     ?V0 + 1,R1
    177          
    178            deallocate = true;
   \   000018   75..01       MOV     ?V0 + 3,#0x1
    179          
    180            /* Use the first byte of the message as the command ID */
    181            switch ( msg->hdr.event )
   \   00001B   8E82         MOV     DPL,R6
   \   00001D   8F83         MOV     DPH,R7
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   14           DEC     A
   \   000021   6012         JZ      ??MT_ProcessIncomingCommand_0
   \   000023   14           DEC     A
   \   000024   601F         JZ      ??MT_ProcessIncomingCommand_1
   \   000026   24FE         ADD     A,#-0x2
   \   000028   6024         JZ      ??MT_ProcessIncomingCommand_2
   \   00002A   24FE         ADD     A,#-0x2
   \   00002C   6076         JZ      ??MT_ProcessIncomingCommand_3
   \   00002E   24E2         ADD     A,#-0x1e
   \   000030   607B         JZ      ??MT_ProcessIncomingCommand_4
   \   000032   02....       LJMP    ??MT_ProcessIncomingCommand_5 & 0xFFFF
    182            {
    183              case CMD_SERIAL_MSG:
    184                MT_ProcessIncoming(msg->msg);
   \                     ??MT_ProcessIncomingCommand_0:
   \   000035                ; Setup parameters for call to function MT_ProcessIncoming
   \   000035   8E82         MOV     DPL,R6
   \   000037   8F83         MOV     DPH,R7
   \   000039   A3           INC     DPTR
   \   00003A   A3           INC     DPTR
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   FA           MOV     R2,A
   \   00003D   A3           INC     DPTR
   \   00003E   E0           MOVX    A,@DPTR
   \   00003F   FB           MOV     R3,A
   \   000040   12....       LCALL   ??MT_ProcessIncoming?relay
    185                break;
   \   000043   807F         SJMP    ??MT_ProcessIncomingCommand_5
    186          
    187              case CMD_DEBUG_MSG:
    188                MT_ProcessDebugMsg( (mtDebugMsg_t *)msg );
   \                     ??MT_ProcessIncomingCommand_1:
   \   000045                ; Setup parameters for call to function MT_ProcessDebugMsg
   \   000045   EE           MOV     A,R6
   \   000046   FA           MOV     R2,A
   \   000047   EF           MOV     A,R7
   \   000048   FB           MOV     R3,A
   \   000049   12....       LCALL   ??MT_ProcessDebugMsg?relay
    189                break;
   \   00004C   8076         SJMP    ??MT_ProcessIncomingCommand_5
    190          
    191              case CB_FUNC:
    192                /*
    193                  Build SPI message here instead of redundantly calling MT_BuildSPIMsg
    194                  because we have copied data already in the allocated message
    195                */
    196          
    197                /* msg_ptr is the beginning of the intended SPI message */
    198                len = SPI_0DATA_MSG_LEN + msg_ptr[DATALEN_FIELD];
   \                     ??MT_ProcessIncomingCommand_2:
   \   00004E   85..82       MOV     DPL,?V0 + 0
   \   000051   85..83       MOV     DPH,?V0 + 1
   \   000054   A3           INC     DPTR
   \   000055   A3           INC     DPTR
   \   000056   A3           INC     DPTR
   \   000057   E0           MOVX    A,@DPTR
   \   000058   2405         ADD     A,#0x5
   \   00005A   F5..         MOV     ?V0 + 2,A
    199          
    200                /*
    201                  FCS goes to the last byte in the message and is calculated over all
    202                  the bytes except FCS and SOP
    203                */
    204                msg_ptr[len-1] = MT_UartCalcFCS(msg_ptr + 1, (byte)(len-2));
   \   00005C                ; Setup parameters for call to function MT_UartCalcFCS
   \   00005C   74FE         MOV     A,#-0x2
   \   00005E   25..         ADD     A,?V0 + 2
   \   000060   F9           MOV     R1,A
   \   000061   85..82       MOV     DPL,?V0 + 0
   \   000064   85..83       MOV     DPH,?V0 + 1
   \   000067   A3           INC     DPTR
   \   000068   AA82         MOV     R2,DPL
   \   00006A   AB83         MOV     R3,DPH
   \   00006C   12....       LCALL   ??MT_UartCalcFCS?relay
   \   00006F   E9           MOV     A,R1
   \   000070   C0E0         PUSH    A
   \   000072   85....       MOV     ?V0 + 4,?V0 + 2
   \   000075   75..00       MOV     ?V0 + 5,#0x0
   \   000078   E5..         MOV     A,?V0 + 0
   \   00007A   25..         ADD     A,?V0 + 4
   \   00007C   F8           MOV     R0,A
   \   00007D   E5..         MOV     A,?V0 + 1
   \   00007F   35..         ADDC    A,?V0 + 5
   \   000081   F9           MOV     R1,A
   \   000082   E8           MOV     A,R0
   \   000083   24FF         ADD     A,#-0x1
   \   000085   F582         MOV     DPL,A
   \   000087   E9           MOV     A,R1
   \   000088   34FF         ADDC    A,#-0x1
   \   00008A   F583         MOV     DPH,A
   \   00008C   D0E0         POP     A
   \   00008E   F0           MOVX    @DPTR,A
    205          
    206          #ifdef MT_UART_DEFAULT_PORT
    207                HalUARTWrite ( MT_UART_DEFAULT_PORT, msg_ptr, len );
   \   00008F                ; Setup parameters for call to function HalUARTWrite
   \   00008F   85....       MOV     ?V0 + 4,?V0 + 2
   \   000092   75..00       MOV     ?V0 + 5,#0x0
   \   000095   AC..         MOV     R4,?V0 + 4
   \   000097   AD..         MOV     R5,?V0 + 5
   \   000099   AA..         MOV     R2,?V0 + 0
   \   00009B   AB..         MOV     R3,?V0 + 1
   \   00009D   7900         MOV     R1,#0x0
   \   00009F   12....       LCALL   ??HalUARTWrite?relay
    208          #endif
    209                break;
   \   0000A2   8020         SJMP    ??MT_ProcessIncomingCommand_5
    210          
    211              case CMD_DEBUG_STR:
    212                MT_ProcessDebugStr( (mtDebugStr_t *)msg );
   \                     ??MT_ProcessIncomingCommand_3:
   \   0000A4                ; Setup parameters for call to function MT_ProcessDebugStr
   \   0000A4   EE           MOV     A,R6
   \   0000A5   FA           MOV     R2,A
   \   0000A6   EF           MOV     A,R7
   \   0000A7   FB           MOV     R3,A
   \   0000A8   12....       LCALL   ??MT_ProcessDebugStr?relay
    213                break;
   \   0000AB   8017         SJMP    ??MT_ProcessIncomingCommand_5
    214          
    215          #if !defined ( NONWK )
    216              case MT_SYS_APP_RSP_MSG:
    217                len = SPI_0DATA_MSG_LEN + msg_ptr[DATALEN_FIELD];
   \                     ??MT_ProcessIncomingCommand_4:
   \   0000AD   85..82       MOV     DPL,?V0 + 0
   \   0000B0   85..83       MOV     DPH,?V0 + 1
   \   0000B3   A3           INC     DPTR
   \   0000B4   A3           INC     DPTR
   \   0000B5   A3           INC     DPTR
   \   0000B6   E0           MOVX    A,@DPTR
   \   0000B7   2405         ADD     A,#0x5
   \   0000B9   F5..         MOV     ?V0 + 2,A
    218                MTProcessAppRspMsg( msg_ptr, len );
   \   0000BB                ; Setup parameters for call to function MTProcessAppRspMsg
   \   0000BB   A9..         MOV     R1,?V0 + 2
   \   0000BD   AA..         MOV     R2,?V0 + 0
   \   0000BF   AB..         MOV     R3,?V0 + 1
   \   0000C1   12....       LCALL   ??MTProcessAppRspMsg?relay
    219                break;
    220          #endif  // NONWK
    221          
    222          #if defined (MT_UTIL_FUNC)
    223          #if defined ZCL_KEY_ESTABLISH
    224              case ZCL_KEY_ESTABLISH_IND:
    225                MT_UtilKeyEstablishInd((keyEstablishmentInd_t *)msg);
    226                break;
    227          #endif        
    228          #endif        
    229          #ifdef MT_ZDO_CB_FUNC
    230              case ZDO_STATE_CHANGE:
    231                MT_ZdoStateChangeCB((osal_event_hdr_t *)msg);
    232                break;
    233          #endif
    234          
    235              default:
    236                break;
    237            }
    238          
    239            if ( deallocate )
   \                     ??MT_ProcessIncomingCommand_5:
   \   0000C4   E5..         MOV     A,?V0 + 3
   \   0000C6   6008         JZ      ??MT_ProcessIncomingCommand_6
    240            {
    241              osal_msg_deallocate( (uint8 *)msg );
   \   0000C8                ; Setup parameters for call to function osal_msg_deallocate
   \   0000C8   EE           MOV     A,R6
   \   0000C9   FA           MOV     R2,A
   \   0000CA   EF           MOV     A,R7
   \   0000CB   FB           MOV     R3,A
   \   0000CC   12....       LCALL   ??osal_msg_deallocate?relay
   \   0000CF   E9           MOV     A,R1
    242            }
    243          }
   \                     ??MT_ProcessIncomingCommand_6:
   \   0000D0   7F06         MOV     R7,#0x6
   \   0000D2   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_TaskInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_TaskInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ProcessIncomingCommand?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ProcessIncomingCommand
    244          
    245          #ifdef MT_TASK
    246          /***************************************************************************************************
    247           * @fn      MT_TransportAlloc
    248           *
    249           * @brief   Allocate memory for transport msg
    250           *
    251           * @param   uint8 cmd0 - The first byte of the MT command id containing the command type and subsystem.
    252           *          uint8 len - length
    253           *
    254           * @return  pointer the allocated memory or NULL if fail to allocate the memory
    255           ***************************************************************************************************/
    256          uint8 *MT_TransportAlloc(uint8 cmd0, uint8 len)
    257          {
    258            uint8 *p;
    259          
    260            (void)cmd0;  // Intentionally unreferenced parameter
    261            
    262            /* Allocate a buffer of data length + SOP+CMD+FCS (5bytes) */
    263            p = osal_msg_allocate(len + SPI_0DATA_MSG_LEN);
    264          
    265            if (p)
    266            {
    267              p++; /* Save space for SOP_VALUE, msg structure */
    268              return p;
    269            }
    270            else
    271            {
    272              return NULL;
    273            }
    274          }
    275          
    276          /***************************************************************************************************
    277           * @fn      MT_TransportSend
    278           *
    279           * @brief   Fill in SOP and FCS then send out the msg
    280           *
    281           * @param   uint8 *pBuf - pointer to the message that contains CMD, length, data and FCS
    282           *
    283           * @return  None
    284           ***************************************************************************************************/
    285          void MT_TransportSend(uint8 *pBuf)
    286          {
    287            uint8 *msgPtr;
    288            uint8 dataLen = pBuf[0]; /* Data length is on byte #1 from the pointer */
    289          
    290            /* Move back to the SOP */
    291            msgPtr = pBuf-1;
    292          
    293            /* Insert SOP */
    294            msgPtr[0] = MT_UART_SOF;
    295          
    296            /* Insert FCS */
    297            msgPtr[SPI_0DATA_MSG_LEN - 1 + dataLen] = MT_UartCalcFCS (pBuf, (3 + dataLen));
    298          
    299            /* Send to UART */
    300          #ifdef MT_UART_DEFAULT_PORT
    301            HalUARTWrite(MT_UART_DEFAULT_PORT, msgPtr, dataLen + SPI_0DATA_MSG_LEN);
    302          #endif
    303          
    304            /* Deallocate */
    305            osal_msg_deallocate(msgPtr);
    306          }
    307          #endif /* MT_TASK */
    308          /***************************************************************************************************
    309           ***************************************************************************************************/

   Maximum stack usage in bytes:

   ISTACK PSTACK XSTACK Function
   ------ ------ ------ --------
       0      0     14  MT_ProcessEvent
                          0 0 14 -> MT_ProcessIncomingCommand
                          0 0 14 -> osal_msg_receive
       1      0     28  MT_ProcessIncomingCommand
                          0 0 14 -> HalUARTWrite
                          0 0 14 -> MTProcessAppRspMsg
                          0 0 14 -> MT_ProcessDebugMsg
                          0 0 14 -> MT_ProcessDebugStr
                          0 0 14 -> MT_ProcessIncoming
                          0 0 14 -> MT_UartCalcFCS
                          0 0 14 -> osal_msg_deallocate
       0      0      9  MT_TaskInit
                          0 0  9 -> MT_Init
                          0 0  9 -> MT_UartInit
                          0 0  9 -> MT_UartRegisterTaskID


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
       6  ??MT_ProcessEvent?relay
       6  ??MT_ProcessIncomingCommand?relay
       6  ??MT_TaskInit?relay
      90  MT_ProcessEvent
     213  MT_ProcessIncomingCommand
      25  MT_TaskInit

 
 328 bytes in segment BANKED_CODE
  18 bytes in segment BANK_RELAYS
 
 346 bytes of CODE memory

Errors: none
Warnings: none
