###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.20.2.41139 for 8051             11/Jan/2016  16:35:10 #
# Copyright 2004-2013 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#                                                                             #
#    Source file        =  C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Comp #
#                          onents\mt\MT_AF.c                                  #
#    Command line       =  -f C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\P #
#                          rojects\zstack\Samples\SampleApp\CC2530DB\..\..\.. #
#                          \Tools\CC2530DB\f8wCoord.cfg (-DCPU32MHZ           #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DZDO_COORDINATOR -DRTR_NWK -DBLINK_LEDS) -f     #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\To #
#                          ols\CC2530DB\f8wConfig.cfg (-DSECURE=0             #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFF1                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116 "-DCONST=const __code"    #
#                          -DGENERIC=__generic -DRFD_RCVC_ALWAYS_ON=TRUE      #
#                          -DPOLL_RATE=1000 -DQUEUED_POLL_RATE=100            #
#                          -DRESPONSE_POLL_RATE=100) -DREJOIN_POLL_RATE=440   #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Comp #
#                          onents\mt\MT_AF.c -D ZIGBEEPRO -D ZTOOL_P1 -D      #
#                          xMT_TASK -D xMT_SYS_FUNC -D xMT_ZDO_FUNC -D        #
#                          LCD_SUPPORTED=DEBUG -lC C:\Users\ArnoldWorkStation #
#                          \Desktop\ZigbeeTest\Projects\zstack\Samples\Sample #
#                          App\CC2530DB\CoordinatorEB-Pro\List\ -lA           #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\Coordinator #
#                          EB-Pro\List\ --diag_suppress Pe001,Pa010 -o        #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\Coordinator #
#                          EB-Pro\Obj\ -e --no_cse --no_unroll --no_inline    #
#                          --no_code_motion --no_tbaa --debug --core=plain    #
#                          --dptr=16,1 --data_model=large                     #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I C:\Users\ArnoldWorkStation #
#                          \Desktop\ZigbeeTest\Projects\zstack\Samples\Sample #
#                          App\CC2530DB\ -I C:\Users\ArnoldWorkStation\Deskto #
#                          p\ZigbeeTest\Projects\zstack\Samples\SampleApp\CC2 #
#                          530DB\..\SOURCE\ -I C:\Users\ArnoldWorkStation\Des #
#                          ktop\ZigbeeTest\Projects\zstack\Samples\SampleApp\ #
#                          CC2530DB\..\..\..\ZMAIN\TI2530DB\ -I               #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\MT\ -I C:\Users\ArnoldWorkStation\D #
#                          esktop\ZigbeeTest\Projects\zstack\Samples\SampleAp #
#                          p\CC2530DB\..\..\..\..\..\COMPONENTS\HAL\INCLUDE\  #
#                          -I C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\P #
#                          rojects\zstack\Samples\SampleApp\CC2530DB\..\..\.. #
#                          \..\..\COMPONENTS\HAL\TARGET\CC2530EB\ -I          #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\OSAL\MCU\CCSOC\ -I                  #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\OSAL\INCLUDE\ -I                    #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\STACK\AF\ -I                        #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\STACK\NWK\ -I                       #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\STACK\SEC\ -I                       #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\STACK\SAPI\ -I                      #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\STACK\SYS\ -I                       #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\STACK\ZDO\ -I                       #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\ZMAC\F8W\ -I                        #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\ZMAC\ -I C:\Users\ArnoldWorkStation #
#                          \Desktop\ZigbeeTest\Projects\zstack\Samples\Sample #
#                          App\CC2530DB\..\..\..\..\..\COMPONENTS\SERVICES\SA #
#                          DDR\ -I C:\Users\ArnoldWorkStation\Desktop\ZigbeeT #
#                          est\Projects\zstack\Samples\SampleApp\CC2530DB\..\ #
#                          ..\..\..\..\COMPONENTS\SERVICES\SDATA\ -I          #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\MAC\INCLUDE\ -I                     #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\MAC\HIGH_LEVEL\ -I                  #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\MAC\LOW_LEVEL\srf04\ -I             #
#                          C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\..\..\..\.. #
#                          \..\COMPONENTS\MAC\LOW_LEVEL\srf04\SINGLE_CHIP\    #
#                          -On --require_prototypes                           #
#    List file          =  C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\Coordinator #
#                          EB-Pro\List\MT_AF.lst                              #
#    Object file        =  C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Proj #
#                          ects\zstack\Samples\SampleApp\CC2530DB\Coordinator #
#                          EB-Pro\Obj\MT_AF.r51                               #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\ArnoldWorkStation\Desktop\ZigbeeTest\Components\mt\MT_AF.c
      1          /**************************************************************************************************
      2            Filename:       MT_AF.c
      3            Revised:        $Date: 2010-01-08 16:52:37 -0800 (Fri, 08 Jan 2010) $
      4            Revision:       $Revision: 21471 $
      5          
      6          
      7            Description:    MonitorTest functions for the AF layer.
      8          
      9          
     10            Copyright 2007-2010 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com.
     39          
     40          **************************************************************************************************/
     41          
     42          /***************************************************************************************************
     43           * INCLUDES
     44           ***************************************************************************************************/
     45          #include "ZComDef.h"
     46          #include "OSAL.h"
     47          #include "MT.h"
     48          #include "MT_AF.h"
     49          #include "MT_ZDO.h"
     50          #include "nwk.h"
     51          #include "OnBoard.h"
     52          #include "MT_UART.h"
     53          
     54          #if defined INTER_PAN
     55          #include "stub_aps.h"
     56          #endif
     57          
     58          /***************************************************************************************************
     59           * GLOBAL VARIABLES
     60           ***************************************************************************************************/
     61          
     62          #if defined ( MT_AF_CB_FUNC )
     63          uint16 _afCallbackSub;
     64          #endif
     65          
     66          /***************************************************************************************************
     67           * LOCAL FUNCTIONS
     68           ***************************************************************************************************/
     69          void MT_AfRegister(uint8 *pBuf);
     70          void MT_AfDataRequest(uint8 *pBuf);
     71          
     72          #if defined ( ZIGBEE_SOURCE_ROUTING )
     73          void MT_AfDataRequestSrcRtg(uint8 *pBuf);
     74          #endif
     75          
     76          #if defined INTER_PAN
     77          static void MT_AfInterPanCtl(uint8 *pBuf);
     78          #endif
     79          
     80          /***************************************************************************************************
     81           * @fn      MT_afCommandProcessing
     82           *
     83           * @brief   Process all the AF commands that are issued by test tool
     84           *
     85           * @param   pBuf - pointer to the received buffer
     86           *
     87           * @return  status
     88           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     89          uint8 MT_AfCommandProcessing(uint8 *pBuf)
   \                     MT_AfCommandProcessing:
     90          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
     91            uint8 status = MT_RPC_SUCCESS;
   \   000009   75..00       MOV     ?V0 + 0,#0x0
     92          
     93            switch (pBuf[MT_RPC_POS_CMD1])
   \   00000C   8E82         MOV     DPL,R6
   \   00000E   8F83         MOV     DPH,R7
   \   000010   A3           INC     DPTR
   \   000011   A3           INC     DPTR
   \   000012   E0           MOVX    A,@DPTR
   \   000013   600B         JZ      ??MT_AfCommandProcessing_0
   \   000015   14           DEC     A
   \   000016   6011         JZ      ??MT_AfCommandProcessing_1
   \   000018   14           DEC     A
   \   000019   600E         JZ      ??MT_AfCommandProcessing_1
   \   00001B   14           DEC     A
   \   00001C   6014         JZ      ??MT_AfCommandProcessing_2
   \   00001E   801B         SJMP    ??MT_AfCommandProcessing_3
     94            {
     95              case MT_AF_REGISTER:
     96                MT_AfRegister(pBuf);
   \                     ??MT_AfCommandProcessing_0:
   \   000020                ; Setup parameters for call to function MT_AfRegister
   \   000020   EE           MOV     A,R6
   \   000021   FA           MOV     R2,A
   \   000022   EF           MOV     A,R7
   \   000023   FB           MOV     R3,A
   \   000024   12....       LCALL   ??MT_AfRegister?relay
     97                break;
   \   000027   8015         SJMP    ??MT_AfCommandProcessing_4
     98          
     99              case MT_AF_DATA_REQUEST:
    100              case MT_AF_DATA_REQUEST_EXT:
    101                MT_AfDataRequest(pBuf);
   \                     ??MT_AfCommandProcessing_1:
   \   000029                ; Setup parameters for call to function MT_AfDataRequest
   \   000029   EE           MOV     A,R6
   \   00002A   FA           MOV     R2,A
   \   00002B   EF           MOV     A,R7
   \   00002C   FB           MOV     R3,A
   \   00002D   12....       LCALL   ??MT_AfDataRequest?relay
    102                break;
   \   000030   800C         SJMP    ??MT_AfCommandProcessing_4
    103                
    104          #if defined ( ZIGBEE_SOURCE_ROUTING )
    105              case MT_AF_DATA_REQUEST_SRCRTG:
    106                MT_AfDataRequestSrcRtg(pBuf);
   \                     ??MT_AfCommandProcessing_2:
   \   000032                ; Setup parameters for call to function MT_AfDataRequestSrcRtg
   \   000032   EE           MOV     A,R6
   \   000033   FA           MOV     R2,A
   \   000034   EF           MOV     A,R7
   \   000035   FB           MOV     R3,A
   \   000036   12....       LCALL   ??MT_AfDataRequestSrcRtg?relay
    107                break;
   \   000039   8003         SJMP    ??MT_AfCommandProcessing_4
    108          #endif
    109                
    110          #if defined INTER_PAN
    111              case MT_AF_INTER_PAN_CTL:
    112                MT_AfInterPanCtl(pBuf);
    113                break; 
    114          #endif
    115                
    116              default:
    117                status = MT_RPC_ERR_COMMAND_ID;
   \                     ??MT_AfCommandProcessing_3:
   \   00003B   75..02       MOV     ?V0 + 0,#0x2
    118                break;
    119            }
    120          
    121            return status;
   \                     ??MT_AfCommandProcessing_4:
   \   00003E   A9..         MOV     R1,?V0 + 0
   \   000040   7F01         MOV     R7,#0x1
   \   000042   02....       LJMP    ?BANKED_LEAVE_XDATA
    122          }
    123          
    124          /***************************************************************************************************
    125           * @fn      MT_AfRegister
    126           *
    127           * @brief   Process AF Register command
    128           *
    129           * @param   pBuf - pointer to the received buffer
    130           *
    131           * @return  none
    132           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    133          void MT_AfRegister(uint8 *pBuf)
   \                     MT_AfRegister:
    134          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
    135            uint8 cmdId;
    136            uint8 retValue = ZMemError;
   \   00000E   85..82       MOV     DPL,?XSP + 0
   \   000011   85..83       MOV     DPH,?XSP + 1
   \   000014   7410         MOV     A,#0x10
   \   000016   F0           MOVX    @DPTR,A
    137            endPointDesc_t *epDesc;
    138          
    139            /* parse header */
    140            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   000017   85..82       MOV     DPL,?V0 + 0
   \   00001A   85..83       MOV     DPH,?V0 + 1
   \   00001D   A3           INC     DPTR
   \   00001E   A3           INC     DPTR
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   F5..         MOV     ?V0 + 2,A
    141            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000022   E5..         MOV     A,?V0 + 0
   \   000024   2403         ADD     A,#0x3
   \   000026   F5..         MOV     ?V0 + 0,A
   \   000028   E5..         MOV     A,?V0 + 1
   \   00002A   3400         ADDC    A,#0x0
   \   00002C   F5..         MOV     ?V0 + 1,A
    142          
    143            epDesc = (endPointDesc_t *)osal_mem_alloc(sizeof(endPointDesc_t));
   \   00002E                ; Setup parameters for call to function osal_mem_alloc
   \   00002E   7A06         MOV     R2,#0x6
   \   000030   7B00         MOV     R3,#0x0
   \   000032   12....       LCALL   ??osal_mem_alloc?relay
   \   000035   8A..         MOV     ?V0 + 4,R2
   \   000037   8B..         MOV     ?V0 + 5,R3
   \   000039   AE..         MOV     R6,?V0 + 4
   \   00003B   AF..         MOV     R7,?V0 + 5
    144            if ( epDesc )
   \   00003D   EE           MOV     A,R6
   \   00003E   4F           ORL     A,R7
   \   00003F   6047         JZ      ??MT_AfRegister_0
    145            {
    146              epDesc->task_id = &MT_TaskID;
   \   000041   8E82         MOV     DPL,R6
   \   000043   8F83         MOV     DPH,R7
   \   000045   A3           INC     DPTR
   \   000046   74..         MOV     A,#MT_TaskID & 0xff
   \   000048   F0           MOVX    @DPTR,A
   \   000049   A3           INC     DPTR
   \   00004A   74..         MOV     A,#(MT_TaskID >> 8) & 0xff
   \   00004C   F0           MOVX    @DPTR,A
    147              retValue = MT_BuildEndpointDesc( pBuf, epDesc );
   \   00004D                ; Setup parameters for call to function MT_BuildEndpointDesc
   \   00004D   EE           MOV     A,R6
   \   00004E   FC           MOV     R4,A
   \   00004F   EF           MOV     A,R7
   \   000050   FD           MOV     R5,A
   \   000051   AA..         MOV     R2,?V0 + 0
   \   000053   AB..         MOV     R3,?V0 + 1
   \   000055   12....       LCALL   ??MT_BuildEndpointDesc?relay
   \   000058   E9           MOV     A,R1
   \   000059   85..82       MOV     DPL,?XSP + 0
   \   00005C   85..83       MOV     DPH,?XSP + 1
   \   00005F   F0           MOVX    @DPTR,A
    148              if ( retValue == ZSuccess )
   \   000060   85..82       MOV     DPL,?XSP + 0
   \   000063   85..83       MOV     DPH,?XSP + 1
   \   000066   E0           MOVX    A,@DPTR
   \   000067   700F         JNZ     ??MT_AfRegister_1
    149              {
    150                retValue = afRegister( epDesc );
   \   000069                ; Setup parameters for call to function afRegister
   \   000069   EE           MOV     A,R6
   \   00006A   FA           MOV     R2,A
   \   00006B   EF           MOV     A,R7
   \   00006C   FB           MOV     R3,A
   \   00006D   12....       LCALL   ??afRegister?relay
   \   000070   E9           MOV     A,R1
   \   000071   85..82       MOV     DPL,?XSP + 0
   \   000074   85..83       MOV     DPH,?XSP + 1
   \   000077   F0           MOVX    @DPTR,A
    151              }
    152          
    153              if ( retValue != ZSuccess )
   \                     ??MT_AfRegister_1:
   \   000078   85..82       MOV     DPL,?XSP + 0
   \   00007B   85..83       MOV     DPH,?XSP + 1
   \   00007E   E0           MOVX    A,@DPTR
   \   00007F   6007         JZ      ??MT_AfRegister_0
    154              {
    155                osal_mem_free( epDesc );
   \   000081                ; Setup parameters for call to function osal_mem_free
   \   000081   EE           MOV     A,R6
   \   000082   FA           MOV     R2,A
   \   000083   EF           MOV     A,R7
   \   000084   FB           MOV     R3,A
   \   000085   12....       LCALL   ??osal_mem_free?relay
    156              }
    157            }
    158          
    159            /* Build and send back the response */
    160            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_AF), cmdId, 1, &retValue);
   \                     ??MT_AfRegister_0:
   \   000088                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000088   85..82       MOV     DPL,?XSP + 0
   \   00008B   85..83       MOV     DPH,?XSP + 1
   \   00008E   AC82         MOV     R4,DPL
   \   000090   AD83         MOV     R5,DPH
   \   000092   7B01         MOV     R3,#0x1
   \   000094   AA..         MOV     R2,?V0 + 2
   \   000096   7964         MOV     R1,#0x64
   \   000098   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    161          }
   \   00009B   7401         MOV     A,#0x1
   \   00009D   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000A0   7F06         MOV     R7,#0x6
   \   0000A2   02....       LJMP    ?BANKED_LEAVE_XDATA
    162          
    163          /***************************************************************************************************
    164           * @fn      MT_AfDataRequest
    165           *
    166           * @brief   Process AF Register command
    167           *
    168           * @param   pBuf - pointer to the received buffer
    169           *
    170           * @return  none
    171           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    172          void MT_AfDataRequest(uint8 *pBuf)
   \                     MT_AfDataRequest:
    173          {
   \   000000   74EA         MOV     A,#-0x16
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 22
   \   000005                ; Auto size: 14
   \   000005   74F2         MOV     A,#-0xe
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    174            uint8 cmd0, cmd1, tempLen = 0;
   \   00000E   75..00       MOV     ?V0 + 2,#0x0
    175            uint8 retValue = ZFailure;
   \   000011   85..82       MOV     DPL,?XSP + 0
   \   000014   85..83       MOV     DPH,?XSP + 1
   \   000017   7401         MOV     A,#0x1
   \   000019   F0           MOVX    @DPTR,A
    176            endPointDesc_t *epDesc;
    177            byte transId;
    178            afAddrType_t dstAddr;
    179            cId_t cId;
    180            byte txOpts, radius, srcEP;
    181          
    182            /* Parse header */
    183            cmd0 = pBuf[MT_RPC_POS_CMD0];
   \   00001A   8E82         MOV     DPL,R6
   \   00001C   8F83         MOV     DPH,R7
   \   00001E   A3           INC     DPTR
   \   00001F   E0           MOVX    A,@DPTR
   \   000020   F5..         MOV     ?V0 + 10,A
    184            cmd1 = pBuf[MT_RPC_POS_CMD1];
   \   000022   8E82         MOV     DPL,R6
   \   000024   8F83         MOV     DPH,R7
   \   000026   A3           INC     DPTR
   \   000027   A3           INC     DPTR
   \   000028   E0           MOVX    A,@DPTR
   \   000029   F5..         MOV     ?V0 + 3,A
    185            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   00002B   EE           MOV     A,R6
   \   00002C   2403         ADD     A,#0x3
   \   00002E   FE           MOV     R6,A
   \   00002F   EF           MOV     A,R7
   \   000030   3400         ADDC    A,#0x0
   \   000032   FF           MOV     R7,A
    186          
    187            if (cmd1 == MT_AF_DATA_REQUEST_EXT)
   \   000033   7402         MOV     A,#0x2
   \   000035   65..         XRL     A,?V0 + 3
   \   000037   6003         JZ      $+5
   \   000039   02....       LJMP    ??MT_AfDataRequest_0 & 0xFFFF
    188            {
    189              dstAddr.addrMode = (afAddrMode_t)*pBuf++;
   \   00003C   8E82         MOV     DPL,R6
   \   00003E   8F83         MOV     DPH,R7
   \   000040   E0           MOVX    A,@DPTR
   \   000041   C0E0         PUSH    A
   \   000043   740A         MOV     A,#0xa
   \   000045   12....       LCALL   ?XSTACK_DISP0_8
   \   000048   D0E0         POP     A
   \   00004A   F0           MOVX    @DPTR,A
   \   00004B   8E82         MOV     DPL,R6
   \   00004D   8F83         MOV     DPH,R7
   \   00004F   A3           INC     DPTR
   \   000050   AE82         MOV     R6,DPL
   \   000052   AF83         MOV     R7,DPH
    190          
    191              if (dstAddr.addrMode == afAddr64Bit)
   \   000054   740A         MOV     A,#0xa
   \   000056   12....       LCALL   ?XSTACK_DISP0_8
   \   000059   E0           MOVX    A,@DPTR
   \   00005A   6403         XRL     A,#0x3
   \   00005C   702D         JNZ     ??MT_AfDataRequest_1
    192              {
    193                (void)osal_memcpy(dstAddr.addr.extAddr, pBuf, Z_EXTADDR_LEN);
   \   00005E                ; Setup parameters for call to function osal_memcpy
   \   00005E   8E..         MOV     ?V0 + 4,R6
   \   000060   8F..         MOV     ?V0 + 5,R7
   \   000062   75..00       MOV     ?V0 + 6,#0x0
   \   000065   78..         MOV     R0,#?V0 + 4
   \   000067   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   00006A   7C08         MOV     R4,#0x8
   \   00006C   7D00         MOV     R5,#0x0
   \   00006E   7405         MOV     A,#0x5
   \   000070   12....       LCALL   ?XSTACK_DISP0_8
   \   000073   AA82         MOV     R2,DPL
   \   000075   AB83         MOV     R3,DPH
   \   000077   12....       LCALL   ??osal_memcpy?relay
   \   00007A   7403         MOV     A,#0x3
   \   00007C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00007F   8A..         MOV     ?V0 + 4,R2
   \   000081   8B..         MOV     ?V0 + 5,R3
   \   000083   85..82       MOV     DPL,?V0 + 4
   \   000086   85..83       MOV     DPH,?V0 + 5
   \   000089   8024         SJMP    ??MT_AfDataRequest_2
    194              }
    195              else
    196              {
    197                dstAddr.addr.shortAddr = BUILD_UINT16(pBuf[0], pBuf[1]);
   \                     ??MT_AfDataRequest_1:
   \   00008B   8E82         MOV     DPL,R6
   \   00008D   8F83         MOV     DPH,R7
   \   00008F   E0           MOVX    A,@DPTR
   \   000090   FA           MOV     R2,A
   \   000091   7B00         MOV     R3,#0x0
   \   000093   8E82         MOV     DPL,R6
   \   000095   8F83         MOV     DPH,R7
   \   000097   A3           INC     DPTR
   \   000098   E0           MOVX    A,@DPTR
   \   000099   F8           MOV     R0,A
   \   00009A   7900         MOV     R1,#0x0
   \   00009C   E4           CLR     A
   \   00009D   C8           XCH     A,R0
   \   00009E   F9           MOV     R1,A
   \   00009F   EA           MOV     A,R2
   \   0000A0   28           ADD     A,R0
   \   0000A1   F8           MOV     R0,A
   \   0000A2   EB           MOV     A,R3
   \   0000A3   39           ADDC    A,R1
   \   0000A4   F9           MOV     R1,A
   \   0000A5   7402         MOV     A,#0x2
   \   0000A7   12....       LCALL   ?XSTACK_DISP0_8
   \   0000AA   E8           MOV     A,R0
   \   0000AB   F0           MOVX    @DPTR,A
   \   0000AC   A3           INC     DPTR
   \   0000AD   E9           MOV     A,R1
   \   0000AE   F0           MOVX    @DPTR,A
    198              }
    199              pBuf += Z_EXTADDR_LEN;
   \                     ??MT_AfDataRequest_2:
   \   0000AF   EE           MOV     A,R6
   \   0000B0   2408         ADD     A,#0x8
   \   0000B2   FE           MOV     R6,A
   \   0000B3   EF           MOV     A,R7
   \   0000B4   3400         ADDC    A,#0x0
   \   0000B6   FF           MOV     R7,A
    200          
    201              dstAddr.endPoint = *pBuf++;
   \   0000B7   8E82         MOV     DPL,R6
   \   0000B9   8F83         MOV     DPH,R7
   \   0000BB   E0           MOVX    A,@DPTR
   \   0000BC   C0E0         PUSH    A
   \   0000BE   740B         MOV     A,#0xb
   \   0000C0   12....       LCALL   ?XSTACK_DISP0_8
   \   0000C3   D0E0         POP     A
   \   0000C5   F0           MOVX    @DPTR,A
   \   0000C6   8E82         MOV     DPL,R6
   \   0000C8   8F83         MOV     DPH,R7
   \   0000CA   A3           INC     DPTR
   \   0000CB   AE82         MOV     R6,DPL
   \   0000CD   AF83         MOV     R7,DPH
    202              dstAddr.panId = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   0000CF   8E82         MOV     DPL,R6
   \   0000D1   8F83         MOV     DPH,R7
   \   0000D3   E0           MOVX    A,@DPTR
   \   0000D4   FA           MOV     R2,A
   \   0000D5   7B00         MOV     R3,#0x0
   \   0000D7   8E82         MOV     DPL,R6
   \   0000D9   8F83         MOV     DPH,R7
   \   0000DB   A3           INC     DPTR
   \   0000DC   E0           MOVX    A,@DPTR
   \   0000DD   F8           MOV     R0,A
   \   0000DE   7900         MOV     R1,#0x0
   \   0000E0   E4           CLR     A
   \   0000E1   C8           XCH     A,R0
   \   0000E2   F9           MOV     R1,A
   \   0000E3   EA           MOV     A,R2
   \   0000E4   28           ADD     A,R0
   \   0000E5   F8           MOV     R0,A
   \   0000E6   EB           MOV     A,R3
   \   0000E7   39           ADDC    A,R1
   \   0000E8   F9           MOV     R1,A
   \   0000E9   740C         MOV     A,#0xc
   \   0000EB   12....       LCALL   ?XSTACK_DISP0_8
   \   0000EE   E8           MOV     A,R0
   \   0000EF   F0           MOVX    @DPTR,A
   \   0000F0   A3           INC     DPTR
   \   0000F1   E9           MOV     A,R1
   \   0000F2   F0           MOVX    @DPTR,A
    203              pBuf += 2;
   \   0000F3   EE           MOV     A,R6
   \   0000F4   2402         ADD     A,#0x2
   \   0000F6   FE           MOV     R6,A
   \   0000F7   EF           MOV     A,R7
   \   0000F8   3400         ADDC    A,#0x0
   \   0000FA   FF           MOV     R7,A
   \   0000FB   8058         SJMP    ??MT_AfDataRequest_3
    204            }
    205            else
    206            {
    207              /* Destination address */
    208              dstAddr.addrMode = afAddr16Bit;
   \                     ??MT_AfDataRequest_0:
   \   0000FD   740A         MOV     A,#0xa
   \   0000FF   12....       LCALL   ?XSTACK_DISP0_8
   \   000102   7402         MOV     A,#0x2
   \   000104   F0           MOVX    @DPTR,A
    209              dstAddr.addr.shortAddr = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   000105   8E82         MOV     DPL,R6
   \   000107   8F83         MOV     DPH,R7
   \   000109   E0           MOVX    A,@DPTR
   \   00010A   FA           MOV     R2,A
   \   00010B   7B00         MOV     R3,#0x0
   \   00010D   8E82         MOV     DPL,R6
   \   00010F   8F83         MOV     DPH,R7
   \   000111   A3           INC     DPTR
   \   000112   E0           MOVX    A,@DPTR
   \   000113   F8           MOV     R0,A
   \   000114   7900         MOV     R1,#0x0
   \   000116   E4           CLR     A
   \   000117   C8           XCH     A,R0
   \   000118   F9           MOV     R1,A
   \   000119   EA           MOV     A,R2
   \   00011A   28           ADD     A,R0
   \   00011B   F8           MOV     R0,A
   \   00011C   EB           MOV     A,R3
   \   00011D   39           ADDC    A,R1
   \   00011E   F9           MOV     R1,A
   \   00011F   7402         MOV     A,#0x2
   \   000121   12....       LCALL   ?XSTACK_DISP0_8
   \   000124   E8           MOV     A,R0
   \   000125   F0           MOVX    @DPTR,A
   \   000126   A3           INC     DPTR
   \   000127   E9           MOV     A,R1
   \   000128   F0           MOVX    @DPTR,A
    210              pBuf += 2;
   \   000129   EE           MOV     A,R6
   \   00012A   2402         ADD     A,#0x2
   \   00012C   FE           MOV     R6,A
   \   00012D   EF           MOV     A,R7
   \   00012E   3400         ADDC    A,#0x0
   \   000130   FF           MOV     R7,A
    211          
    212              /* Destination endpoint */
    213              dstAddr.endPoint = *pBuf++;
   \   000131   8E82         MOV     DPL,R6
   \   000133   8F83         MOV     DPH,R7
   \   000135   E0           MOVX    A,@DPTR
   \   000136   C0E0         PUSH    A
   \   000138   740B         MOV     A,#0xb
   \   00013A   12....       LCALL   ?XSTACK_DISP0_8
   \   00013D   D0E0         POP     A
   \   00013F   F0           MOVX    @DPTR,A
   \   000140   8E82         MOV     DPL,R6
   \   000142   8F83         MOV     DPH,R7
   \   000144   A3           INC     DPTR
   \   000145   AE82         MOV     R6,DPL
   \   000147   AF83         MOV     R7,DPH
    214              dstAddr.panId = 0;
   \   000149   740C         MOV     A,#0xc
   \   00014B   12....       LCALL   ?XSTACK_DISP0_8
   \   00014E   7400         MOV     A,#0x0
   \   000150   F0           MOVX    @DPTR,A
   \   000151   A3           INC     DPTR
   \   000152   7400         MOV     A,#0x0
   \   000154   F0           MOVX    @DPTR,A
    215            }
    216          
    217            /* Source endpoint */
    218            srcEP = *pBuf++;
   \                     ??MT_AfDataRequest_3:
   \   000155   8E82         MOV     DPL,R6
   \   000157   8F83         MOV     DPH,R7
   \   000159   E0           MOVX    A,@DPTR
   \   00015A   F5..         MOV     ?V0 + 7,A
   \   00015C   8E82         MOV     DPL,R6
   \   00015E   8F83         MOV     DPH,R7
   \   000160   A3           INC     DPTR
   \   000161   AE82         MOV     R6,DPL
   \   000163   AF83         MOV     R7,DPH
    219            epDesc = afFindEndPointDesc( srcEP );
   \   000165                ; Setup parameters for call to function afFindEndPointDesc
   \   000165   A9..         MOV     R1,?V0 + 7
   \   000167   12....       LCALL   ??afFindEndPointDesc?relay
   \   00016A   8A..         MOV     ?V0 + 4,R2
   \   00016C   8B..         MOV     ?V0 + 5,R3
   \   00016E   85....       MOV     ?V0 + 12,?V0 + 4
   \   000171   85....       MOV     ?V0 + 13,?V0 + 5
    220          
    221            /* ClusterId */
    222            cId = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   000174   8E82         MOV     DPL,R6
   \   000176   8F83         MOV     DPH,R7
   \   000178   E0           MOVX    A,@DPTR
   \   000179   FA           MOV     R2,A
   \   00017A   7B00         MOV     R3,#0x0
   \   00017C   8E82         MOV     DPL,R6
   \   00017E   8F83         MOV     DPH,R7
   \   000180   A3           INC     DPTR
   \   000181   E0           MOVX    A,@DPTR
   \   000182   F8           MOV     R0,A
   \   000183   7900         MOV     R1,#0x0
   \   000185   E4           CLR     A
   \   000186   C8           XCH     A,R0
   \   000187   F9           MOV     R1,A
   \   000188   EA           MOV     A,R2
   \   000189   28           ADD     A,R0
   \   00018A   F8           MOV     R0,A
   \   00018B   EB           MOV     A,R3
   \   00018C   39           ADDC    A,R1
   \   00018D   F9           MOV     R1,A
   \   00018E   88..         MOV     ?V0 + 0,R0
   \   000190   89..         MOV     ?V0 + 1,R1
    223            pBuf +=2;
   \   000192   EE           MOV     A,R6
   \   000193   2402         ADD     A,#0x2
   \   000195   FE           MOV     R6,A
   \   000196   EF           MOV     A,R7
   \   000197   3400         ADDC    A,#0x0
   \   000199   FF           MOV     R7,A
    224          
    225            /* TransId */
    226            transId = *pBuf++;
   \   00019A   8E82         MOV     DPL,R6
   \   00019C   8F83         MOV     DPH,R7
   \   00019E   E0           MOVX    A,@DPTR
   \   00019F   C0E0         PUSH    A
   \   0001A1   7401         MOV     A,#0x1
   \   0001A3   12....       LCALL   ?XSTACK_DISP0_8
   \   0001A6   D0E0         POP     A
   \   0001A8   F0           MOVX    @DPTR,A
   \   0001A9   8E82         MOV     DPL,R6
   \   0001AB   8F83         MOV     DPH,R7
   \   0001AD   A3           INC     DPTR
   \   0001AE   AE82         MOV     R6,DPL
   \   0001B0   AF83         MOV     R7,DPH
    227          
    228            /* TxOption */
    229            txOpts = *pBuf++;
   \   0001B2   8E82         MOV     DPL,R6
   \   0001B4   8F83         MOV     DPH,R7
   \   0001B6   E0           MOVX    A,@DPTR
   \   0001B7   F5..         MOV     ?V0 + 9,A
   \   0001B9   8E82         MOV     DPL,R6
   \   0001BB   8F83         MOV     DPH,R7
   \   0001BD   A3           INC     DPTR
   \   0001BE   AE82         MOV     R6,DPL
   \   0001C0   AF83         MOV     R7,DPH
    230          
    231            /* Radius */
    232            radius = *pBuf++;
   \   0001C2   8E82         MOV     DPL,R6
   \   0001C4   8F83         MOV     DPH,R7
   \   0001C6   E0           MOVX    A,@DPTR
   \   0001C7   F5..         MOV     ?V0 + 8,A
   \   0001C9   8E82         MOV     DPL,R6
   \   0001CB   8F83         MOV     DPH,R7
   \   0001CD   A3           INC     DPTR
   \   0001CE   AE82         MOV     R6,DPL
   \   0001D0   AF83         MOV     R7,DPH
    233          
    234            /* Length */
    235            tempLen = *pBuf++;
   \   0001D2   8E82         MOV     DPL,R6
   \   0001D4   8F83         MOV     DPH,R7
   \   0001D6   E0           MOVX    A,@DPTR
   \   0001D7   F5..         MOV     ?V0 + 2,A
   \   0001D9   8E82         MOV     DPL,R6
   \   0001DB   8F83         MOV     DPH,R7
   \   0001DD   A3           INC     DPTR
   \   0001DE   AE82         MOV     R6,DPL
   \   0001E0   AF83         MOV     R7,DPH
    236          
    237            if ( epDesc == NULL )
   \   0001E2   E5..         MOV     A,?V0 + 12
   \   0001E4   45..         ORL     A,?V0 + 13
   \   0001E6   700B         JNZ     ??MT_AfDataRequest_4
    238            {
    239              retValue = afStatus_INVALID_PARAMETER;
   \   0001E8   85..82       MOV     DPL,?XSP + 0
   \   0001EB   85..83       MOV     DPH,?XSP + 1
   \   0001EE   7402         MOV     A,#0x2
   \   0001F0   F0           MOVX    @DPTR,A
   \   0001F1   8051         SJMP    ??MT_AfDataRequest_5
    240            }
    241            else
    242            {
    243              retValue = AF_DataRequest( &dstAddr, epDesc, cId, tempLen, pBuf, &transId, txOpts, radius );
   \                     ??MT_AfDataRequest_4:
   \   0001F3                ; Setup parameters for call to function AF_DataRequest
   \   0001F3   E5..         MOV     A,?V0 + 8
   \   0001F5   F5..         MOV     ?V0 + 4,A
   \   0001F7   78..         MOV     R0,#?V0 + 4
   \   0001F9   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0001FC   7402         MOV     A,#0x2
   \   0001FE   12....       LCALL   ?XSTACK_DISP0_8
   \   000201   8582..       MOV     ?V0 + 4,DPL
   \   000204   8583..       MOV     ?V0 + 5,DPH
   \   000207   78..         MOV     R0,#?V0 + 4
   \   000209   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00020C   8E..         MOV     ?V0 + 4,R6
   \   00020E   8F..         MOV     ?V0 + 5,R7
   \   000210   78..         MOV     R0,#?V0 + 4
   \   000212   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000215   85....       MOV     ?V0 + 4,?V0 + 2
   \   000218   75..00       MOV     ?V0 + 5,#0x0
   \   00021B   78..         MOV     R0,#?V0 + 4
   \   00021D   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000220   78..         MOV     R0,#?V0 + 0
   \   000222   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000225   A9..         MOV     R1,?V0 + 9
   \   000227   AC..         MOV     R4,?V0 + 12
   \   000229   AD..         MOV     R5,?V0 + 13
   \   00022B   740B         MOV     A,#0xb
   \   00022D   12....       LCALL   ?XSTACK_DISP0_8
   \   000230   AA82         MOV     R2,DPL
   \   000232   AB83         MOV     R3,DPH
   \   000234   12....       LCALL   ??AF_DataRequest?relay
   \   000237   7409         MOV     A,#0x9
   \   000239   12....       LCALL   ?DEALLOC_XSTACK8
   \   00023C   E9           MOV     A,R1
   \   00023D   85..82       MOV     DPL,?XSP + 0
   \   000240   85..83       MOV     DPH,?XSP + 1
   \   000243   F0           MOVX    @DPTR,A
    244            }
    245          
    246            if (MT_RPC_CMD_SREQ == (cmd0 & MT_RPC_CMD_TYPE_MASK))
   \                     ??MT_AfDataRequest_5:
   \   000244   74E0         MOV     A,#-0x20
   \   000246   55..         ANL     A,?V0 + 10
   \   000248   6420         XRL     A,#0x20
   \   00024A   7013         JNZ     ??MT_AfDataRequest_6
    247            {
    248              MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP|(uint8)MT_RPC_SYS_AF), cmd1, 1, &retValue);
   \   00024C                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   00024C   85..82       MOV     DPL,?XSP + 0
   \   00024F   85..83       MOV     DPH,?XSP + 1
   \   000252   AC82         MOV     R4,DPL
   \   000254   AD83         MOV     R5,DPH
   \   000256   7B01         MOV     R3,#0x1
   \   000258   AA..         MOV     R2,?V0 + 3
   \   00025A   7964         MOV     R1,#0x64
   \   00025C   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    249            }
    250          }
   \                     ??MT_AfDataRequest_6:
   \   00025F   740E         MOV     A,#0xe
   \   000261   12....       LCALL   ?DEALLOC_XSTACK8
   \   000264   7F0E         MOV     R7,#0xe
   \   000266   02....       LJMP    ?BANKED_LEAVE_XDATA
    251          
    252          
    253          #if defined ( ZIGBEE_SOURCE_ROUTING )
    254          
    255          /***************************************************************************************************
    256           * @fn      MT_AfDataRequestSrcRtg
    257           *
    258           * @brief   Process AF Register command
    259           *
    260           * @param   pBuf - pointer to the received buffer
    261           *
    262           * @return  none
    263           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    264          void MT_AfDataRequestSrcRtg(uint8 *pBuf)
   \                     MT_AfDataRequestSrcRtg:
    265          {
   \   000000   74E8         MOV     A,#-0x18
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 24
   \   000005                ; Auto size: 14
   \   000005   74F2         MOV     A,#-0xe
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    266            uint8 cmdId, dataLen = 0;
   \   00000E   75..00       MOV     ?V0 + 3,#0x0
    267            uint8 retValue = ZFailure;
   \   000011   85..82       MOV     DPL,?XSP + 0
   \   000014   85..83       MOV     DPH,?XSP + 1
   \   000017   7401         MOV     A,#0x1
   \   000019   F0           MOVX    @DPTR,A
    268            endPointDesc_t *epDesc;
    269            byte transId;
    270            afAddrType_t dstAddr;
    271            cId_t cId;
    272            byte txOpts, radius, srcEP, relayCnt;
    273            uint16 *pRelayList;
    274            uint8 i;
    275          
    276            /* parse header */
    277            cmdId = pBuf[MT_RPC_POS_CMD1];
   \   00001A   8E82         MOV     DPL,R6
   \   00001C   8F83         MOV     DPH,R7
   \   00001E   A3           INC     DPTR
   \   00001F   A3           INC     DPTR
   \   000020   E0           MOVX    A,@DPTR
   \   000021   F5..         MOV     ?V0 + 5,A
    278            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   000023   EE           MOV     A,R6
   \   000024   2403         ADD     A,#0x3
   \   000026   FE           MOV     R6,A
   \   000027   EF           MOV     A,R7
   \   000028   3400         ADDC    A,#0x0
   \   00002A   FF           MOV     R7,A
    279          
    280            /* Destination address */
    281            /* Initialize the panID field to zero to avoid inter-pan */
    282            osal_memset( &dstAddr, 0, sizeof(afAddrType_t) ); 
   \   00002B                ; Setup parameters for call to function osal_memset
   \   00002B   7C0C         MOV     R4,#0xc
   \   00002D   7D00         MOV     R5,#0x0
   \   00002F   7900         MOV     R1,#0x0
   \   000031   7402         MOV     A,#0x2
   \   000033   12....       LCALL   ?XSTACK_DISP0_8
   \   000036   AA82         MOV     R2,DPL
   \   000038   AB83         MOV     R3,DPH
   \   00003A   12....       LCALL   ??osal_memset?relay
    283            dstAddr.addrMode = afAddr16Bit;
   \   00003D   740A         MOV     A,#0xa
   \   00003F   12....       LCALL   ?XSTACK_DISP0_8
   \   000042   7402         MOV     A,#0x2
   \   000044   F0           MOVX    @DPTR,A
    284            dstAddr.addr.shortAddr = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   000045   8E82         MOV     DPL,R6
   \   000047   8F83         MOV     DPH,R7
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   F8           MOV     R0,A
   \   00004B   7900         MOV     R1,#0x0
   \   00004D   8E82         MOV     DPL,R6
   \   00004F   8F83         MOV     DPH,R7
   \   000051   A3           INC     DPTR
   \   000052   E0           MOVX    A,@DPTR
   \   000053   FA           MOV     R2,A
   \   000054   7B00         MOV     R3,#0x0
   \   000056   E4           CLR     A
   \   000057   CA           XCH     A,R2
   \   000058   FB           MOV     R3,A
   \   000059   E8           MOV     A,R0
   \   00005A   2A           ADD     A,R2
   \   00005B   F8           MOV     R0,A
   \   00005C   E9           MOV     A,R1
   \   00005D   3B           ADDC    A,R3
   \   00005E   F9           MOV     R1,A
   \   00005F   7402         MOV     A,#0x2
   \   000061   12....       LCALL   ?XSTACK_DISP0_8
   \   000064   E8           MOV     A,R0
   \   000065   F0           MOVX    @DPTR,A
   \   000066   A3           INC     DPTR
   \   000067   E9           MOV     A,R1
   \   000068   F0           MOVX    @DPTR,A
    285            pBuf += 2;
   \   000069   EE           MOV     A,R6
   \   00006A   2402         ADD     A,#0x2
   \   00006C   FE           MOV     R6,A
   \   00006D   EF           MOV     A,R7
   \   00006E   3400         ADDC    A,#0x0
   \   000070   FF           MOV     R7,A
    286          
    287            /* Destination endpoint */
    288            dstAddr.endPoint = *pBuf++;
   \   000071   8E82         MOV     DPL,R6
   \   000073   8F83         MOV     DPH,R7
   \   000075   E0           MOVX    A,@DPTR
   \   000076   C0E0         PUSH    A
   \   000078   740B         MOV     A,#0xb
   \   00007A   12....       LCALL   ?XSTACK_DISP0_8
   \   00007D   D0E0         POP     A
   \   00007F   F0           MOVX    @DPTR,A
   \   000080   8E82         MOV     DPL,R6
   \   000082   8F83         MOV     DPH,R7
   \   000084   A3           INC     DPTR
   \   000085   AE82         MOV     R6,DPL
   \   000087   AF83         MOV     R7,DPH
    289          
    290            /* Source endpoint */
    291            srcEP = *pBuf++;
   \   000089   8E82         MOV     DPL,R6
   \   00008B   8F83         MOV     DPH,R7
   \   00008D   E0           MOVX    A,@DPTR
   \   00008E   F5..         MOV     ?V0 + 10,A
   \   000090   8E82         MOV     DPL,R6
   \   000092   8F83         MOV     DPH,R7
   \   000094   A3           INC     DPTR
   \   000095   AE82         MOV     R6,DPL
   \   000097   AF83         MOV     R7,DPH
    292            epDesc = afFindEndPointDesc( srcEP );
   \   000099                ; Setup parameters for call to function afFindEndPointDesc
   \   000099   A9..         MOV     R1,?V0 + 10
   \   00009B   12....       LCALL   ??afFindEndPointDesc?relay
   \   00009E   8A..         MOV     ?V0 + 8,R2
   \   0000A0   8B..         MOV     ?V0 + 9,R3
   \   0000A2   85....       MOV     ?V0 + 14,?V0 + 8
   \   0000A5   85....       MOV     ?V0 + 15,?V0 + 9
    293          
    294            /* ClusterId */
    295            cId = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   0000A8   8E82         MOV     DPL,R6
   \   0000AA   8F83         MOV     DPH,R7
   \   0000AC   E0           MOVX    A,@DPTR
   \   0000AD   F8           MOV     R0,A
   \   0000AE   7900         MOV     R1,#0x0
   \   0000B0   8E82         MOV     DPL,R6
   \   0000B2   8F83         MOV     DPH,R7
   \   0000B4   A3           INC     DPTR
   \   0000B5   E0           MOVX    A,@DPTR
   \   0000B6   FA           MOV     R2,A
   \   0000B7   7B00         MOV     R3,#0x0
   \   0000B9   E4           CLR     A
   \   0000BA   CA           XCH     A,R2
   \   0000BB   FB           MOV     R3,A
   \   0000BC   E8           MOV     A,R0
   \   0000BD   2A           ADD     A,R2
   \   0000BE   F8           MOV     R0,A
   \   0000BF   E9           MOV     A,R1
   \   0000C0   3B           ADDC    A,R3
   \   0000C1   F9           MOV     R1,A
   \   0000C2   88..         MOV     ?V0 + 0,R0
   \   0000C4   89..         MOV     ?V0 + 1,R1
    296            pBuf +=2;
   \   0000C6   EE           MOV     A,R6
   \   0000C7   2402         ADD     A,#0x2
   \   0000C9   FE           MOV     R6,A
   \   0000CA   EF           MOV     A,R7
   \   0000CB   3400         ADDC    A,#0x0
   \   0000CD   FF           MOV     R7,A
    297          
    298            /* TransId */
    299            transId = *pBuf++;
   \   0000CE   8E82         MOV     DPL,R6
   \   0000D0   8F83         MOV     DPH,R7
   \   0000D2   E0           MOVX    A,@DPTR
   \   0000D3   C0E0         PUSH    A
   \   0000D5   7401         MOV     A,#0x1
   \   0000D7   12....       LCALL   ?XSTACK_DISP0_8
   \   0000DA   D0E0         POP     A
   \   0000DC   F0           MOVX    @DPTR,A
   \   0000DD   8E82         MOV     DPL,R6
   \   0000DF   8F83         MOV     DPH,R7
   \   0000E1   A3           INC     DPTR
   \   0000E2   AE82         MOV     R6,DPL
   \   0000E4   AF83         MOV     R7,DPH
    300          
    301            /* TxOption */
    302            txOpts = *pBuf++;
   \   0000E6   8E82         MOV     DPL,R6
   \   0000E8   8F83         MOV     DPH,R7
   \   0000EA   E0           MOVX    A,@DPTR
   \   0000EB   F5..         MOV     ?V0 + 12,A
   \   0000ED   8E82         MOV     DPL,R6
   \   0000EF   8F83         MOV     DPH,R7
   \   0000F1   A3           INC     DPTR
   \   0000F2   AE82         MOV     R6,DPL
   \   0000F4   AF83         MOV     R7,DPH
    303          
    304            /* Radius */
    305            radius = *pBuf++;
   \   0000F6   8E82         MOV     DPL,R6
   \   0000F8   8F83         MOV     DPH,R7
   \   0000FA   E0           MOVX    A,@DPTR
   \   0000FB   F5..         MOV     ?V0 + 11,A
   \   0000FD   8E82         MOV     DPL,R6
   \   0000FF   8F83         MOV     DPH,R7
   \   000101   A3           INC     DPTR
   \   000102   AE82         MOV     R6,DPL
   \   000104   AF83         MOV     R7,DPH
    306            
    307            /* Source route relay count */
    308            relayCnt = *pBuf++;
   \   000106   8E82         MOV     DPL,R6
   \   000108   8F83         MOV     DPH,R7
   \   00010A   E0           MOVX    A,@DPTR
   \   00010B   F5..         MOV     ?V0 + 4,A
   \   00010D   8E82         MOV     DPL,R6
   \   00010F   8F83         MOV     DPH,R7
   \   000111   A3           INC     DPTR
   \   000112   AE82         MOV     R6,DPL
   \   000114   AF83         MOV     R7,DPH
    309            
    310            /* Convert the source route relay list */
    311            if( (pRelayList = osal_mem_alloc( relayCnt * sizeof( uint16 ))) != NULL )
   \   000116                ; Setup parameters for call to function osal_mem_alloc
   \   000116   E5..         MOV     A,?V0 + 4
   \   000118   AA..         MOV     R2,?V0 + 4
   \   00011A   7B00         MOV     R3,#0x0
   \   00011C   EA           MOV     A,R2
   \   00011D   75F002       MOV     B,#0x2
   \   000120   A4           MUL     AB
   \   000121   CA           XCH     A,R2
   \   000122   A8F0         MOV     R0,B
   \   000124   75F000       MOV     B,#0x0
   \   000127   A4           MUL     AB
   \   000128   28           ADD     A,R0
   \   000129   F8           MOV     R0,A
   \   00012A   75F002       MOV     B,#0x2
   \   00012D   EB           MOV     A,R3
   \   00012E   A4           MUL     AB
   \   00012F   28           ADD     A,R0
   \   000130   FB           MOV     R3,A
   \   000131   12....       LCALL   ??osal_mem_alloc?relay
   \   000134   8A..         MOV     ?V0 + 8,R2
   \   000136   8B..         MOV     ?V0 + 9,R3
   \   000138   A8..         MOV     R0,?V0 + 8
   \   00013A   A9..         MOV     R1,?V0 + 9
   \   00013C   88..         MOV     ?V0 + 6,R0
   \   00013E   89..         MOV     ?V0 + 7,R1
   \   000140   E8           MOV     A,R0
   \   000141   49           ORL     A,R1
   \   000142   7003         JNZ     $+5
   \   000144   02....       LJMP    ??MT_AfDataRequestSrcRtg_0 & 0xFFFF
    312            {
    313              for( i = 0; i < relayCnt; i++ )
   \   000147   75..00       MOV     ?V0 + 2,#0x0
   \                     ??MT_AfDataRequestSrcRtg_1:
   \   00014A   E5..         MOV     A,?V0 + 2
   \   00014C   C3           CLR     C
   \   00014D   95..         SUBB    A,?V0 + 4
   \   00014F   5050         JNC     ??MT_AfDataRequestSrcRtg_2
    314              {
    315                pRelayList[i]  = BUILD_UINT16( pBuf[0], pBuf[1] );
   \   000151   8E82         MOV     DPL,R6
   \   000153   8F83         MOV     DPH,R7
   \   000155   E0           MOVX    A,@DPTR
   \   000156   F8           MOV     R0,A
   \   000157   7900         MOV     R1,#0x0
   \   000159   8E82         MOV     DPL,R6
   \   00015B   8F83         MOV     DPH,R7
   \   00015D   A3           INC     DPTR
   \   00015E   E0           MOVX    A,@DPTR
   \   00015F   FA           MOV     R2,A
   \   000160   7B00         MOV     R3,#0x0
   \   000162   E4           CLR     A
   \   000163   CA           XCH     A,R2
   \   000164   FB           MOV     R3,A
   \   000165   E8           MOV     A,R0
   \   000166   2A           ADD     A,R2
   \   000167   F8           MOV     R0,A
   \   000168   E9           MOV     A,R1
   \   000169   3B           ADDC    A,R3
   \   00016A   F9           MOV     R1,A
   \   00016B   E5..         MOV     A,?V0 + 2
   \   00016D   AA..         MOV     R2,?V0 + 2
   \   00016F   7B00         MOV     R3,#0x0
   \   000171   EA           MOV     A,R2
   \   000172   75F002       MOV     B,#0x2
   \   000175   A4           MUL     AB
   \   000176   CA           XCH     A,R2
   \   000177   ACF0         MOV     R4,B
   \   000179   75F000       MOV     B,#0x0
   \   00017C   A4           MUL     AB
   \   00017D   2C           ADD     A,R4
   \   00017E   FC           MOV     R4,A
   \   00017F   75F002       MOV     B,#0x2
   \   000182   EB           MOV     A,R3
   \   000183   A4           MUL     AB
   \   000184   2C           ADD     A,R4
   \   000185   FB           MOV     R3,A
   \   000186   E5..         MOV     A,?V0 + 6
   \   000188   2A           ADD     A,R2
   \   000189   F582         MOV     DPL,A
   \   00018B   E5..         MOV     A,?V0 + 7
   \   00018D   3B           ADDC    A,R3
   \   00018E   F583         MOV     DPH,A
   \   000190   E8           MOV     A,R0
   \   000191   F0           MOVX    @DPTR,A
   \   000192   A3           INC     DPTR
   \   000193   E9           MOV     A,R1
   \   000194   F0           MOVX    @DPTR,A
    316                pBuf += 2;
   \   000195   EE           MOV     A,R6
   \   000196   2402         ADD     A,#0x2
   \   000198   FE           MOV     R6,A
   \   000199   EF           MOV     A,R7
   \   00019A   3400         ADDC    A,#0x0
   \   00019C   FF           MOV     R7,A
    317              }
   \   00019D   05..         INC     ?V0 + 2
   \   00019F   80A9         SJMP    ??MT_AfDataRequestSrcRtg_1
    318            
    319              /* Data payload Length */
    320              dataLen = *pBuf++;
   \                     ??MT_AfDataRequestSrcRtg_2:
   \   0001A1   8E82         MOV     DPL,R6
   \   0001A3   8F83         MOV     DPH,R7
   \   0001A5   E0           MOVX    A,@DPTR
   \   0001A6   F5..         MOV     ?V0 + 3,A
   \   0001A8   8E82         MOV     DPL,R6
   \   0001AA   8F83         MOV     DPH,R7
   \   0001AC   A3           INC     DPTR
   \   0001AD   AE82         MOV     R6,DPL
   \   0001AF   AF83         MOV     R7,DPH
    321          
    322              if ( epDesc == NULL )
   \   0001B1   E5..         MOV     A,?V0 + 14
   \   0001B3   45..         ORL     A,?V0 + 15
   \   0001B5   700B         JNZ     ??MT_AfDataRequestSrcRtg_3
    323              {
    324                retValue = afStatus_INVALID_PARAMETER;
   \   0001B7   85..82       MOV     DPL,?XSP + 0
   \   0001BA   85..83       MOV     DPH,?XSP + 1
   \   0001BD   7402         MOV     A,#0x2
   \   0001BF   F0           MOVX    @DPTR,A
   \   0001C0   805F         SJMP    ??MT_AfDataRequestSrcRtg_4
    325              }
    326              else
    327              {
    328                retValue = AF_DataRequestSrcRtg( &dstAddr, epDesc, cId, dataLen, pBuf, 
    329                                               &transId, txOpts, radius, relayCnt, pRelayList );
   \                     ??MT_AfDataRequestSrcRtg_3:
   \   0001C2                ; Setup parameters for call to function AF_DataRequestSrcRtg
   \   0001C2   78..         MOV     R0,#?V0 + 6
   \   0001C4   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001C7   E5..         MOV     A,?V0 + 4
   \   0001C9   F5..         MOV     ?V0 + 8,A
   \   0001CB   78..         MOV     R0,#?V0 + 8
   \   0001CD   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0001D0   E5..         MOV     A,?V0 + 11
   \   0001D2   F5..         MOV     ?V0 + 8,A
   \   0001D4   78..         MOV     R0,#?V0 + 8
   \   0001D6   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0001D9   7405         MOV     A,#0x5
   \   0001DB   12....       LCALL   ?XSTACK_DISP0_8
   \   0001DE   8582..       MOV     ?V0 + 8,DPL
   \   0001E1   8583..       MOV     ?V0 + 9,DPH
   \   0001E4   78..         MOV     R0,#?V0 + 8
   \   0001E6   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001E9   8E..         MOV     ?V0 + 8,R6
   \   0001EB   8F..         MOV     ?V0 + 9,R7
   \   0001ED   78..         MOV     R0,#?V0 + 8
   \   0001EF   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001F2   85....       MOV     ?V0 + 8,?V0 + 3
   \   0001F5   75..00       MOV     ?V0 + 9,#0x0
   \   0001F8   78..         MOV     R0,#?V0 + 8
   \   0001FA   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0001FD   78..         MOV     R0,#?V0 + 0
   \   0001FF   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000202   A9..         MOV     R1,?V0 + 12
   \   000204   AC..         MOV     R4,?V0 + 14
   \   000206   AD..         MOV     R5,?V0 + 15
   \   000208   740E         MOV     A,#0xe
   \   00020A   12....       LCALL   ?XSTACK_DISP0_8
   \   00020D   AA82         MOV     R2,DPL
   \   00020F   AB83         MOV     R3,DPH
   \   000211   12....       LCALL   ??AF_DataRequestSrcRtg?relay
   \   000214   740C         MOV     A,#0xc
   \   000216   12....       LCALL   ?DEALLOC_XSTACK8
   \   000219   E9           MOV     A,R1
   \   00021A   85..82       MOV     DPL,?XSP + 0
   \   00021D   85..83       MOV     DPH,?XSP + 1
   \   000220   F0           MOVX    @DPTR,A
    330              }
    331              
    332              /* Free the memory allocated */
    333              osal_mem_free( pRelayList );
   \                     ??MT_AfDataRequestSrcRtg_4:
   \   000221                ; Setup parameters for call to function osal_mem_free
   \   000221   AA..         MOV     R2,?V0 + 6
   \   000223   AB..         MOV     R3,?V0 + 7
   \   000225   12....       LCALL   ??osal_mem_free?relay
   \   000228   8009         SJMP    ??MT_AfDataRequestSrcRtg_5
    334            }
    335            else
    336            {
    337              retValue = afStatus_MEM_FAIL;
   \                     ??MT_AfDataRequestSrcRtg_0:
   \   00022A   85..82       MOV     DPL,?XSP + 0
   \   00022D   85..83       MOV     DPH,?XSP + 1
   \   000230   7410         MOV     A,#0x10
   \   000232   F0           MOVX    @DPTR,A
    338            }
    339              
    340          
    341            /* Build and send back the response */
    342            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_AF), cmdId, 1, &retValue);
   \                     ??MT_AfDataRequestSrcRtg_5:
   \   000233                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000233   85..82       MOV     DPL,?XSP + 0
   \   000236   85..83       MOV     DPH,?XSP + 1
   \   000239   AC82         MOV     R4,DPL
   \   00023B   AD83         MOV     R5,DPH
   \   00023D   7B01         MOV     R3,#0x1
   \   00023F   AA..         MOV     R2,?V0 + 5
   \   000241   7964         MOV     R1,#0x64
   \   000243   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    343          }
   \   000246   740E         MOV     A,#0xe
   \   000248   12....       LCALL   ?DEALLOC_XSTACK8
   \   00024B   7F10         MOV     R7,#0x10
   \   00024D   02....       LJMP    ?BANKED_LEAVE_XDATA
    344          #endif
    345          
    346          #if defined INTER_PAN
    347          /***************************************************************************************************
    348           * @fn      MT_AfInterPanCtl
    349           *
    350           * @brief   Process the AF Inter Pan control command.
    351           *
    352           * @param   pBuf - pointer to the received buffer
    353           *
    354           * @return  none
    355           ***************************************************************************************************/
    356          static void MT_AfInterPanCtl(uint8 *pBuf)
    357          {
    358            uint8 cmd, rtrn;
    359            uint16 panId;
    360            endPointDesc_t *pEP;
    361            
    362            cmd = pBuf[MT_RPC_POS_CMD1];
    363            pBuf += MT_RPC_FRAME_HDR_SZ;
    364          
    365            switch (*pBuf++)  // Inter-pan request parameter.
    366            {
    367            case InterPanClr:
    368              rtrn = StubAPS_SetIntraPanChannel();           // Switch channel back to the NIB channel.
    369              break;
    370          
    371            case InterPanSet:
    372              rtrn = StubAPS_SetInterPanChannel(*pBuf);      // Set channel for inter-pan communication.
    373              break;
    374          
    375            case InterPanReg:
    376              if ((pEP = afFindEndPointDesc(*pBuf)))
    377              {
    378                StubAPS_RegisterApp(pEP);
    379                rtrn = SUCCESS;
    380              }
    381              else
    382              {
    383                rtrn = FAILURE;
    384              }
    385              break;
    386          
    387            case InterPanChk:
    388              panId = BUILD_UINT16(pBuf[0], pBuf[1]);
    389              rtrn = (StubAPS_InterPan(panId, pBuf[2])) ? ZSuccess : ZFailure;
    390              break;
    391          
    392            default:
    393              rtrn = afStatus_INVALID_PARAMETER;
    394              break;
    395            }
    396          
    397            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_AF), cmd, 1, &rtrn);
    398          }
    399          #endif
    400          
    401          /***************************************************************************************************
    402           * @fn      MT_AfDataConfirm
    403           *
    404           * @brief   Process
    405           *
    406           * @param   pBuf - pointer to the received buffer
    407           *
    408           * @return  none
    409           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    410          void MT_AfDataConfirm(afDataConfirm_t *pMsg)
   \                     MT_AfDataConfirm:
    411          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 3
   \   000005   74FD         MOV     A,#-0x3
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    412            uint8 retArray[3];
    413          
    414            retArray[0] = pMsg->hdr.status;
   \   00000E   8E82         MOV     DPL,R6
   \   000010   8F83         MOV     DPH,R7
   \   000012   A3           INC     DPTR
   \   000013   E0           MOVX    A,@DPTR
   \   000014   85..82       MOV     DPL,?XSP + 0
   \   000017   85..83       MOV     DPH,?XSP + 1
   \   00001A   F0           MOVX    @DPTR,A
    415            retArray[1] = pMsg->endpoint;
   \   00001B   8E82         MOV     DPL,R6
   \   00001D   8F83         MOV     DPH,R7
   \   00001F   A3           INC     DPTR
   \   000020   A3           INC     DPTR
   \   000021   E0           MOVX    A,@DPTR
   \   000022   C0E0         PUSH    A
   \   000024   7401         MOV     A,#0x1
   \   000026   12....       LCALL   ?XSTACK_DISP0_8
   \   000029   D0E0         POP     A
   \   00002B   F0           MOVX    @DPTR,A
    416            retArray[2] = pMsg->transID;
   \   00002C   8E82         MOV     DPL,R6
   \   00002E   8F83         MOV     DPH,R7
   \   000030   A3           INC     DPTR
   \   000031   A3           INC     DPTR
   \   000032   A3           INC     DPTR
   \   000033   E0           MOVX    A,@DPTR
   \   000034   C0E0         PUSH    A
   \   000036   7402         MOV     A,#0x2
   \   000038   12....       LCALL   ?XSTACK_DISP0_8
   \   00003B   D0E0         POP     A
   \   00003D   F0           MOVX    @DPTR,A
    417          
    418            /* Build and send back the response */
    419            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_AF), MT_AF_DATA_CONFIRM, 3, retArray);
   \   00003E                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   00003E   85..82       MOV     DPL,?XSP + 0
   \   000041   85..83       MOV     DPH,?XSP + 1
   \   000044   AC82         MOV     R4,DPL
   \   000046   AD83         MOV     R5,DPH
   \   000048   7B03         MOV     R3,#0x3
   \   00004A   7A80         MOV     R2,#-0x80
   \   00004C   7944         MOV     R1,#0x44
   \   00004E   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    420          }
   \   000051   7403         MOV     A,#0x3
   \   000053   12....       LCALL   ?DEALLOC_XSTACK8
   \   000056   7F01         MOV     R7,#0x1
   \   000058   02....       LJMP    ?BANKED_LEAVE_XDATA
    421          
    422          /***************************************************************************************************
    423           * @fn          MT_AfIncomingMsg
    424           *
    425           * @brief       Process the callback subscription for AF Incoming data.
    426           *
    427           * @param       pkt - Incoming AF data.
    428           *
    429           * @return      none
    430           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    431          void MT_AfIncomingMsg(afIncomingMSGPacket_t *pMsg)
   \                     MT_AfIncomingMsg:
    432          {
   \   000000   74EC         MOV     A,#-0x14
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 20
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
    433            uint8 dataLen = pMsg->cmd.DataLength;  /* Length of the data section in the response packet */
   \   000009   E5..         MOV     A,?V0 + 0
   \   00000B   241F         ADD     A,#0x1f
   \   00000D   F582         MOV     DPL,A
   \   00000F   E5..         MOV     A,?V0 + 1
   \   000011   3400         ADDC    A,#0x0
   \   000013   F583         MOV     DPH,A
   \   000015   E0           MOVX    A,@DPTR
   \   000016   F8           MOV     R0,A
   \   000017   A3           INC     DPTR
   \   000018   E0           MOVX    A,@DPTR
   \   000019   F9           MOV     R1,A
   \   00001A   E8           MOV     A,R0
   \   00001B   F5..         MOV     ?V0 + 8,A
    434            uint8 respLen = 17 + dataLen;          /* Length of the whole response packet */
   \   00001D   7411         MOV     A,#0x11
   \   00001F   25..         ADD     A,?V0 + 8
   \   000021   F5..         MOV     ?V0 + 3,A
    435            uint8 cmd = MT_AF_INCOMING_MSG;
   \   000023   75..81       MOV     ?V0 + 2,#-0x7f
    436            uint8 *pRsp, *tempPtr;
    437          
    438          #if defined INTER_PAN
    439            if (StubAPS_InterPan(pMsg->srcAddr.panId, pMsg->srcAddr.endPoint))
    440            {
    441              cmd = MT_AF_INCOMING_MSG_EXT;
    442            }
    443            else
    444          #endif
    445            if (pMsg->srcAddr.addrMode == afAddr64Bit)
   \   000026   E5..         MOV     A,?V0 + 0
   \   000028   240E         ADD     A,#0xe
   \   00002A   F582         MOV     DPL,A
   \   00002C   E5..         MOV     A,?V0 + 1
   \   00002E   3400         ADDC    A,#0x0
   \   000030   F583         MOV     DPH,A
   \   000032   E0           MOVX    A,@DPTR
   \   000033   6403         XRL     A,#0x3
   \   000035   7003         JNZ     ??MT_AfIncomingMsg_0
    446            {
    447              cmd = MT_AF_INCOMING_MSG_EXT;
   \   000037   75..82       MOV     ?V0 + 2,#-0x7e
    448            }
    449          
    450            if (cmd == MT_AF_INCOMING_MSG_EXT)
   \                     ??MT_AfIncomingMsg_0:
   \   00003A   7482         MOV     A,#-0x7e
   \   00003C   65..         XRL     A,?V0 + 2
   \   00003E   7006         JNZ     ??MT_AfIncomingMsg_1
    451            {
    452              respLen += 9;
   \   000040   7409         MOV     A,#0x9
   \   000042   25..         ADD     A,?V0 + 3
   \   000044   F5..         MOV     ?V0 + 3,A
    453            }
    454          
    455            // Attempt to allocate memory for the response packet.
    456            if ((pRsp = osal_mem_alloc(respLen)) == NULL)
   \                     ??MT_AfIncomingMsg_1:
   \   000046                ; Setup parameters for call to function osal_mem_alloc
   \   000046   85....       MOV     ?V0 + 4,?V0 + 3
   \   000049   75..00       MOV     ?V0 + 5,#0x0
   \   00004C   AA..         MOV     R2,?V0 + 4
   \   00004E   AB..         MOV     R3,?V0 + 5
   \   000050   12....       LCALL   ??osal_mem_alloc?relay
   \   000053   8A..         MOV     ?V0 + 4,R2
   \   000055   8B..         MOV     ?V0 + 5,R3
   \   000057   A8..         MOV     R0,?V0 + 4
   \   000059   A9..         MOV     R1,?V0 + 5
   \   00005B   88..         MOV     ?V0 + 10,R0
   \   00005D   89..         MOV     ?V0 + 11,R1
   \   00005F   E8           MOV     A,R0
   \   000060   49           ORL     A,R1
   \   000061   7003         JNZ     $+5
   \   000063   02....       LJMP    ??MT_AfIncomingMsg_2 & 0xFFFF
    457            {
    458              return;
    459            }
    460            tempPtr = pRsp;
   \   000066   AE..         MOV     R6,?V0 + 10
   \   000068   AF..         MOV     R7,?V0 + 11
    461          
    462            /* Fill in the data */
    463          
    464            /* Group ID */
    465            *tempPtr++ = LO_UINT16(pMsg->groupId);
   \   00006A   85..82       MOV     DPL,?V0 + 0
   \   00006D   85..83       MOV     DPH,?V0 + 1
   \   000070   A3           INC     DPTR
   \   000071   A3           INC     DPTR
   \   000072   E0           MOVX    A,@DPTR
   \   000073   F8           MOV     R0,A
   \   000074   A3           INC     DPTR
   \   000075   E0           MOVX    A,@DPTR
   \   000076   F9           MOV     R1,A
   \   000077   E8           MOV     A,R0
   \   000078   8E82         MOV     DPL,R6
   \   00007A   8F83         MOV     DPH,R7
   \   00007C   F0           MOVX    @DPTR,A
   \   00007D   8E82         MOV     DPL,R6
   \   00007F   8F83         MOV     DPH,R7
   \   000081   A3           INC     DPTR
   \   000082   AE82         MOV     R6,DPL
   \   000084   AF83         MOV     R7,DPH
    466            *tempPtr++ = HI_UINT16(pMsg->groupId);
   \   000086   85..82       MOV     DPL,?V0 + 0
   \   000089   85..83       MOV     DPH,?V0 + 1
   \   00008C   A3           INC     DPTR
   \   00008D   A3           INC     DPTR
   \   00008E   E0           MOVX    A,@DPTR
   \   00008F   F8           MOV     R0,A
   \   000090   A3           INC     DPTR
   \   000091   E0           MOVX    A,@DPTR
   \   000092   F9           MOV     R1,A
   \   000093   E4           CLR     A
   \   000094   E9           MOV     A,R1
   \   000095   F8           MOV     R0,A
   \   000096   8E82         MOV     DPL,R6
   \   000098   8F83         MOV     DPH,R7
   \   00009A   F0           MOVX    @DPTR,A
   \   00009B   8E82         MOV     DPL,R6
   \   00009D   8F83         MOV     DPH,R7
   \   00009F   A3           INC     DPTR
   \   0000A0   AE82         MOV     R6,DPL
   \   0000A2   AF83         MOV     R7,DPH
    467          
    468            /* Cluster ID */
    469            *tempPtr++ = LO_UINT16(pMsg->clusterId);
   \   0000A4   85..82       MOV     DPL,?V0 + 0
   \   0000A7   85..83       MOV     DPH,?V0 + 1
   \   0000AA   A3           INC     DPTR
   \   0000AB   A3           INC     DPTR
   \   0000AC   A3           INC     DPTR
   \   0000AD   A3           INC     DPTR
   \   0000AE   E0           MOVX    A,@DPTR
   \   0000AF   F8           MOV     R0,A
   \   0000B0   A3           INC     DPTR
   \   0000B1   E0           MOVX    A,@DPTR
   \   0000B2   F9           MOV     R1,A
   \   0000B3   E8           MOV     A,R0
   \   0000B4   8E82         MOV     DPL,R6
   \   0000B6   8F83         MOV     DPH,R7
   \   0000B8   F0           MOVX    @DPTR,A
   \   0000B9   8E82         MOV     DPL,R6
   \   0000BB   8F83         MOV     DPH,R7
   \   0000BD   A3           INC     DPTR
   \   0000BE   AE82         MOV     R6,DPL
   \   0000C0   AF83         MOV     R7,DPH
    470            *tempPtr++ = HI_UINT16(pMsg->clusterId);
   \   0000C2   85..82       MOV     DPL,?V0 + 0
   \   0000C5   85..83       MOV     DPH,?V0 + 1
   \   0000C8   A3           INC     DPTR
   \   0000C9   A3           INC     DPTR
   \   0000CA   A3           INC     DPTR
   \   0000CB   A3           INC     DPTR
   \   0000CC   E0           MOVX    A,@DPTR
   \   0000CD   F8           MOV     R0,A
   \   0000CE   A3           INC     DPTR
   \   0000CF   E0           MOVX    A,@DPTR
   \   0000D0   F9           MOV     R1,A
   \   0000D1   E4           CLR     A
   \   0000D2   E9           MOV     A,R1
   \   0000D3   F8           MOV     R0,A
   \   0000D4   8E82         MOV     DPL,R6
   \   0000D6   8F83         MOV     DPH,R7
   \   0000D8   F0           MOVX    @DPTR,A
   \   0000D9   8E82         MOV     DPL,R6
   \   0000DB   8F83         MOV     DPH,R7
   \   0000DD   A3           INC     DPTR
   \   0000DE   AE82         MOV     R6,DPL
   \   0000E0   AF83         MOV     R7,DPH
    471          
    472            if (cmd == MT_AF_INCOMING_MSG_EXT)
   \   0000E2   7482         MOV     A,#-0x7e
   \   0000E4   65..         XRL     A,?V0 + 2
   \   0000E6   6003         JZ      $+5
   \   0000E8   02....       LJMP    ??MT_AfIncomingMsg_3 & 0xFFFF
    473            {
    474              *tempPtr++ = pMsg->srcAddr.addrMode;
   \   0000EB   E5..         MOV     A,?V0 + 0
   \   0000ED   240E         ADD     A,#0xe
   \   0000EF   F582         MOV     DPL,A
   \   0000F1   E5..         MOV     A,?V0 + 1
   \   0000F3   3400         ADDC    A,#0x0
   \   0000F5   F583         MOV     DPH,A
   \   0000F7   E0           MOVX    A,@DPTR
   \   0000F8   8E82         MOV     DPL,R6
   \   0000FA   8F83         MOV     DPH,R7
   \   0000FC   F0           MOVX    @DPTR,A
   \   0000FD   8E82         MOV     DPL,R6
   \   0000FF   8F83         MOV     DPH,R7
   \   000101   A3           INC     DPTR
   \   000102   AE82         MOV     R6,DPL
   \   000104   AF83         MOV     R7,DPH
    475          
    476              if (pMsg->srcAddr.addrMode == afAddr64Bit)
   \   000106   E5..         MOV     A,?V0 + 0
   \   000108   240E         ADD     A,#0xe
   \   00010A   F582         MOV     DPL,A
   \   00010C   E5..         MOV     A,?V0 + 1
   \   00010E   3400         ADDC    A,#0x0
   \   000110   F583         MOV     DPH,A
   \   000112   E0           MOVX    A,@DPTR
   \   000113   6403         XRL     A,#0x3
   \   000115   7030         JNZ     ??MT_AfIncomingMsg_4
    477              {
    478                (void)osal_memcpy(tempPtr, pMsg->srcAddr.addr.extAddr, Z_EXTADDR_LEN);
   \   000117                ; Setup parameters for call to function osal_memcpy
   \   000117   E5..         MOV     A,?V0 + 0
   \   000119   2406         ADD     A,#0x6
   \   00011B   F5..         MOV     ?V0 + 4,A
   \   00011D   E5..         MOV     A,?V0 + 1
   \   00011F   3400         ADDC    A,#0x0
   \   000121   F5..         MOV     ?V0 + 5,A
   \   000123   75..00       MOV     ?V0 + 6,#0x0
   \   000126   78..         MOV     R0,#?V0 + 4
   \   000128   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   00012B   7C08         MOV     R4,#0x8
   \   00012D   7D00         MOV     R5,#0x0
   \   00012F   EE           MOV     A,R6
   \   000130   FA           MOV     R2,A
   \   000131   EF           MOV     A,R7
   \   000132   FB           MOV     R3,A
   \   000133   12....       LCALL   ??osal_memcpy?relay
   \   000136   7403         MOV     A,#0x3
   \   000138   12....       LCALL   ?DEALLOC_XSTACK8
   \   00013B   8A..         MOV     ?V0 + 4,R2
   \   00013D   8B..         MOV     ?V0 + 5,R3
   \   00013F   85..82       MOV     DPL,?V0 + 4
   \   000142   85..83       MOV     DPH,?V0 + 5
   \   000145   8031         SJMP    ??MT_AfIncomingMsg_5
    479              }
    480              else
    481              {
    482                tempPtr[0] = LO_UINT16(pMsg->srcAddr.addr.shortAddr);
   \                     ??MT_AfIncomingMsg_4:
   \   000147   85..82       MOV     DPL,?V0 + 0
   \   00014A   85..83       MOV     DPH,?V0 + 1
   \   00014D   A3           INC     DPTR
   \   00014E   A3           INC     DPTR
   \   00014F   A3           INC     DPTR
   \   000150   A3           INC     DPTR
   \   000151   A3           INC     DPTR
   \   000152   A3           INC     DPTR
   \   000153   E0           MOVX    A,@DPTR
   \   000154   F8           MOV     R0,A
   \   000155   A3           INC     DPTR
   \   000156   E0           MOVX    A,@DPTR
   \   000157   F9           MOV     R1,A
   \   000158   E8           MOV     A,R0
   \   000159   8E82         MOV     DPL,R6
   \   00015B   8F83         MOV     DPH,R7
   \   00015D   F0           MOVX    @DPTR,A
    483                tempPtr[1] = HI_UINT16(pMsg->srcAddr.addr.shortAddr);
   \   00015E   85..82       MOV     DPL,?V0 + 0
   \   000161   85..83       MOV     DPH,?V0 + 1
   \   000164   A3           INC     DPTR
   \   000165   A3           INC     DPTR
   \   000166   A3           INC     DPTR
   \   000167   A3           INC     DPTR
   \   000168   A3           INC     DPTR
   \   000169   A3           INC     DPTR
   \   00016A   E0           MOVX    A,@DPTR
   \   00016B   F8           MOV     R0,A
   \   00016C   A3           INC     DPTR
   \   00016D   E0           MOVX    A,@DPTR
   \   00016E   F9           MOV     R1,A
   \   00016F   E4           CLR     A
   \   000170   E9           MOV     A,R1
   \   000171   F8           MOV     R0,A
   \   000172   8E82         MOV     DPL,R6
   \   000174   8F83         MOV     DPH,R7
   \   000176   A3           INC     DPTR
   \   000177   F0           MOVX    @DPTR,A
    484              }
    485              tempPtr += Z_EXTADDR_LEN;
   \                     ??MT_AfIncomingMsg_5:
   \   000178   EE           MOV     A,R6
   \   000179   2408         ADD     A,#0x8
   \   00017B   FE           MOV     R6,A
   \   00017C   EF           MOV     A,R7
   \   00017D   3400         ADDC    A,#0x0
   \   00017F   FF           MOV     R7,A
    486          
    487              *tempPtr++ = pMsg->srcAddr.endPoint;
   \   000180   E5..         MOV     A,?V0 + 0
   \   000182   240F         ADD     A,#0xf
   \   000184   F582         MOV     DPL,A
   \   000186   E5..         MOV     A,?V0 + 1
   \   000188   3400         ADDC    A,#0x0
   \   00018A   F583         MOV     DPH,A
   \   00018C   E0           MOVX    A,@DPTR
   \   00018D   8E82         MOV     DPL,R6
   \   00018F   8F83         MOV     DPH,R7
   \   000191   F0           MOVX    @DPTR,A
   \   000192   8E82         MOV     DPL,R6
   \   000194   8F83         MOV     DPH,R7
   \   000196   A3           INC     DPTR
   \   000197   AE82         MOV     R6,DPL
   \   000199   AF83         MOV     R7,DPH
    488          #if defined INTER_PAN
    489              *tempPtr++ = LO_UINT16(pMsg->srcAddr.panId);
    490              *tempPtr++ = HI_UINT16(pMsg->srcAddr.panId);
    491          #else
    492              *tempPtr++ = 0;
   \   00019B   8E82         MOV     DPL,R6
   \   00019D   8F83         MOV     DPH,R7
   \   00019F   7400         MOV     A,#0x0
   \   0001A1   F0           MOVX    @DPTR,A
   \   0001A2   8E82         MOV     DPL,R6
   \   0001A4   8F83         MOV     DPH,R7
   \   0001A6   A3           INC     DPTR
   \   0001A7   AE82         MOV     R6,DPL
   \   0001A9   AF83         MOV     R7,DPH
    493              *tempPtr++ = 0;
   \   0001AB   8E82         MOV     DPL,R6
   \   0001AD   8F83         MOV     DPH,R7
   \   0001AF   7400         MOV     A,#0x0
   \   0001B1   F0           MOVX    @DPTR,A
   \   0001B2   8E82         MOV     DPL,R6
   \   0001B4   8F83         MOV     DPH,R7
   \   0001B6   A3           INC     DPTR
   \   0001B7   AE82         MOV     R6,DPL
   \   0001B9   AF83         MOV     R7,DPH
   \   0001BB   805D         SJMP    ??MT_AfIncomingMsg_6
    494          #endif
    495            }
    496            else
    497            {
    498              /* Source Address */
    499              *tempPtr++ = LO_UINT16(pMsg->srcAddr.addr.shortAddr);
   \                     ??MT_AfIncomingMsg_3:
   \   0001BD   85..82       MOV     DPL,?V0 + 0
   \   0001C0   85..83       MOV     DPH,?V0 + 1
   \   0001C3   A3           INC     DPTR
   \   0001C4   A3           INC     DPTR
   \   0001C5   A3           INC     DPTR
   \   0001C6   A3           INC     DPTR
   \   0001C7   A3           INC     DPTR
   \   0001C8   A3           INC     DPTR
   \   0001C9   E0           MOVX    A,@DPTR
   \   0001CA   F8           MOV     R0,A
   \   0001CB   A3           INC     DPTR
   \   0001CC   E0           MOVX    A,@DPTR
   \   0001CD   F9           MOV     R1,A
   \   0001CE   E8           MOV     A,R0
   \   0001CF   8E82         MOV     DPL,R6
   \   0001D1   8F83         MOV     DPH,R7
   \   0001D3   F0           MOVX    @DPTR,A
   \   0001D4   8E82         MOV     DPL,R6
   \   0001D6   8F83         MOV     DPH,R7
   \   0001D8   A3           INC     DPTR
   \   0001D9   AE82         MOV     R6,DPL
   \   0001DB   AF83         MOV     R7,DPH
    500              *tempPtr++ = HI_UINT16(pMsg->srcAddr.addr.shortAddr);
   \   0001DD   85..82       MOV     DPL,?V0 + 0
   \   0001E0   85..83       MOV     DPH,?V0 + 1
   \   0001E3   A3           INC     DPTR
   \   0001E4   A3           INC     DPTR
   \   0001E5   A3           INC     DPTR
   \   0001E6   A3           INC     DPTR
   \   0001E7   A3           INC     DPTR
   \   0001E8   A3           INC     DPTR
   \   0001E9   E0           MOVX    A,@DPTR
   \   0001EA   F8           MOV     R0,A
   \   0001EB   A3           INC     DPTR
   \   0001EC   E0           MOVX    A,@DPTR
   \   0001ED   F9           MOV     R1,A
   \   0001EE   E4           CLR     A
   \   0001EF   E9           MOV     A,R1
   \   0001F0   F8           MOV     R0,A
   \   0001F1   8E82         MOV     DPL,R6
   \   0001F3   8F83         MOV     DPH,R7
   \   0001F5   F0           MOVX    @DPTR,A
   \   0001F6   8E82         MOV     DPL,R6
   \   0001F8   8F83         MOV     DPH,R7
   \   0001FA   A3           INC     DPTR
   \   0001FB   AE82         MOV     R6,DPL
   \   0001FD   AF83         MOV     R7,DPH
    501          
    502              /* Source EP */
    503              *tempPtr++ = pMsg->srcAddr.endPoint;
   \   0001FF   E5..         MOV     A,?V0 + 0
   \   000201   240F         ADD     A,#0xf
   \   000203   F582         MOV     DPL,A
   \   000205   E5..         MOV     A,?V0 + 1
   \   000207   3400         ADDC    A,#0x0
   \   000209   F583         MOV     DPH,A
   \   00020B   E0           MOVX    A,@DPTR
   \   00020C   8E82         MOV     DPL,R6
   \   00020E   8F83         MOV     DPH,R7
   \   000210   F0           MOVX    @DPTR,A
   \   000211   8E82         MOV     DPL,R6
   \   000213   8F83         MOV     DPH,R7
   \   000215   A3           INC     DPTR
   \   000216   AE82         MOV     R6,DPL
   \   000218   AF83         MOV     R7,DPH
    504            }
    505          
    506            /* Destination EP */
    507            *tempPtr++ = pMsg->endPoint;
   \                     ??MT_AfIncomingMsg_6:
   \   00021A   E5..         MOV     A,?V0 + 0
   \   00021C   2414         ADD     A,#0x14
   \   00021E   F582         MOV     DPL,A
   \   000220   E5..         MOV     A,?V0 + 1
   \   000222   3400         ADDC    A,#0x0
   \   000224   F583         MOV     DPH,A
   \   000226   E0           MOVX    A,@DPTR
   \   000227   8E82         MOV     DPL,R6
   \   000229   8F83         MOV     DPH,R7
   \   00022B   F0           MOVX    @DPTR,A
   \   00022C   8E82         MOV     DPL,R6
   \   00022E   8F83         MOV     DPH,R7
   \   000230   A3           INC     DPTR
   \   000231   AE82         MOV     R6,DPL
   \   000233   AF83         MOV     R7,DPH
    508          
    509            /* WasBroadCast */
    510            *tempPtr++ = pMsg->wasBroadcast;
   \   000235   E5..         MOV     A,?V0 + 0
   \   000237   2415         ADD     A,#0x15
   \   000239   F582         MOV     DPL,A
   \   00023B   E5..         MOV     A,?V0 + 1
   \   00023D   3400         ADDC    A,#0x0
   \   00023F   F583         MOV     DPH,A
   \   000241   E0           MOVX    A,@DPTR
   \   000242   8E82         MOV     DPL,R6
   \   000244   8F83         MOV     DPH,R7
   \   000246   F0           MOVX    @DPTR,A
   \   000247   8E82         MOV     DPL,R6
   \   000249   8F83         MOV     DPH,R7
   \   00024B   A3           INC     DPTR
   \   00024C   AE82         MOV     R6,DPL
   \   00024E   AF83         MOV     R7,DPH
    511          
    512            /* LinkQuality */
    513            *tempPtr++ = pMsg->LinkQuality;
   \   000250   E5..         MOV     A,?V0 + 0
   \   000252   2416         ADD     A,#0x16
   \   000254   F582         MOV     DPL,A
   \   000256   E5..         MOV     A,?V0 + 1
   \   000258   3400         ADDC    A,#0x0
   \   00025A   F583         MOV     DPH,A
   \   00025C   E0           MOVX    A,@DPTR
   \   00025D   8E82         MOV     DPL,R6
   \   00025F   8F83         MOV     DPH,R7
   \   000261   F0           MOVX    @DPTR,A
   \   000262   8E82         MOV     DPL,R6
   \   000264   8F83         MOV     DPH,R7
   \   000266   A3           INC     DPTR
   \   000267   AE82         MOV     R6,DPL
   \   000269   AF83         MOV     R7,DPH
    514          
    515            /* SecurityUse */
    516            *tempPtr++ = pMsg->SecurityUse;
   \   00026B   E5..         MOV     A,?V0 + 0
   \   00026D   2419         ADD     A,#0x19
   \   00026F   F582         MOV     DPL,A
   \   000271   E5..         MOV     A,?V0 + 1
   \   000273   3400         ADDC    A,#0x0
   \   000275   F583         MOV     DPH,A
   \   000277   E0           MOVX    A,@DPTR
   \   000278   8E82         MOV     DPL,R6
   \   00027A   8F83         MOV     DPH,R7
   \   00027C   F0           MOVX    @DPTR,A
   \   00027D   8E82         MOV     DPL,R6
   \   00027F   8F83         MOV     DPH,R7
   \   000281   A3           INC     DPTR
   \   000282   AE82         MOV     R6,DPL
   \   000284   AF83         MOV     R7,DPH
    517          
    518            /* Timestamp */
    519            *tempPtr++ = BREAK_UINT32(pMsg->timestamp, 0);
   \   000286   E5..         MOV     A,?V0 + 0
   \   000288   241A         ADD     A,#0x1a
   \   00028A   F582         MOV     DPL,A
   \   00028C   E5..         MOV     A,?V0 + 1
   \   00028E   3400         ADDC    A,#0x0
   \   000290   F583         MOV     DPH,A
   \   000292   78..         MOV     R0,#?V0 + 4
   \   000294   12....       LCALL   ?L_MOV_X
   \   000297   E5..         MOV     A,?V0 + 4
   \   000299   8E82         MOV     DPL,R6
   \   00029B   8F83         MOV     DPH,R7
   \   00029D   E5..         MOV     A,?V0 + 4
   \   00029F   F0           MOVX    @DPTR,A
   \   0002A0   8E82         MOV     DPL,R6
   \   0002A2   8F83         MOV     DPH,R7
   \   0002A4   A3           INC     DPTR
   \   0002A5   AE82         MOV     R6,DPL
   \   0002A7   AF83         MOV     R7,DPH
    520            *tempPtr++ = BREAK_UINT32(pMsg->timestamp, 1);
   \   0002A9   E5..         MOV     A,?V0 + 0
   \   0002AB   241A         ADD     A,#0x1a
   \   0002AD   F582         MOV     DPL,A
   \   0002AF   E5..         MOV     A,?V0 + 1
   \   0002B1   3400         ADDC    A,#0x0
   \   0002B3   F583         MOV     DPH,A
   \   0002B5   78..         MOV     R0,#?V0 + 4
   \   0002B7   12....       LCALL   ?L_MOV_X
   \   0002BA   E4           CLR     A
   \   0002BB   E5..         MOV     A,?V0 + 5
   \   0002BD   F5..         MOV     ?V0 + 4,A
   \   0002BF   E5..         MOV     A,?V0 + 4
   \   0002C1   8E82         MOV     DPL,R6
   \   0002C3   8F83         MOV     DPH,R7
   \   0002C5   E5..         MOV     A,?V0 + 4
   \   0002C7   F0           MOVX    @DPTR,A
   \   0002C8   8E82         MOV     DPL,R6
   \   0002CA   8F83         MOV     DPH,R7
   \   0002CC   A3           INC     DPTR
   \   0002CD   AE82         MOV     R6,DPL
   \   0002CF   AF83         MOV     R7,DPH
    521            *tempPtr++ = BREAK_UINT32(pMsg->timestamp, 2);
   \   0002D1   E5..         MOV     A,?V0 + 0
   \   0002D3   241A         ADD     A,#0x1a
   \   0002D5   F582         MOV     DPL,A
   \   0002D7   E5..         MOV     A,?V0 + 1
   \   0002D9   3400         ADDC    A,#0x0
   \   0002DB   F583         MOV     DPH,A
   \   0002DD   78..         MOV     R0,#?V0 + 4
   \   0002DF   12....       LCALL   ?L_MOV_X
   \   0002E2   7410         MOV     A,#0x10
   \   0002E4   78..         MOV     R0,#?V0 + 4
   \   0002E6   12....       LCALL   ?UL_SHR
   \   0002E9   E5..         MOV     A,?V0 + 4
   \   0002EB   8E82         MOV     DPL,R6
   \   0002ED   8F83         MOV     DPH,R7
   \   0002EF   E5..         MOV     A,?V0 + 4
   \   0002F1   F0           MOVX    @DPTR,A
   \   0002F2   8E82         MOV     DPL,R6
   \   0002F4   8F83         MOV     DPH,R7
   \   0002F6   A3           INC     DPTR
   \   0002F7   AE82         MOV     R6,DPL
   \   0002F9   AF83         MOV     R7,DPH
    522            *tempPtr++ = BREAK_UINT32(pMsg->timestamp, 3);
   \   0002FB   E5..         MOV     A,?V0 + 0
   \   0002FD   241A         ADD     A,#0x1a
   \   0002FF   F582         MOV     DPL,A
   \   000301   E5..         MOV     A,?V0 + 1
   \   000303   3400         ADDC    A,#0x0
   \   000305   F583         MOV     DPH,A
   \   000307   78..         MOV     R0,#?V0 + 4
   \   000309   12....       LCALL   ?L_MOV_X
   \   00030C   7418         MOV     A,#0x18
   \   00030E   78..         MOV     R0,#?V0 + 4
   \   000310   12....       LCALL   ?UL_SHR
   \   000313   E5..         MOV     A,?V0 + 4
   \   000315   8E82         MOV     DPL,R6
   \   000317   8F83         MOV     DPH,R7
   \   000319   E5..         MOV     A,?V0 + 4
   \   00031B   F0           MOVX    @DPTR,A
   \   00031C   8E82         MOV     DPL,R6
   \   00031E   8F83         MOV     DPH,R7
   \   000320   A3           INC     DPTR
   \   000321   AE82         MOV     R6,DPL
   \   000323   AF83         MOV     R7,DPH
    523          
    524            /* Transmit Sequence Number */
    525            *tempPtr++ = pMsg->cmd.TransSeqNumber;
   \   000325   E5..         MOV     A,?V0 + 0
   \   000327   241E         ADD     A,#0x1e
   \   000329   F582         MOV     DPL,A
   \   00032B   E5..         MOV     A,?V0 + 1
   \   00032D   3400         ADDC    A,#0x0
   \   00032F   F583         MOV     DPH,A
   \   000331   E0           MOVX    A,@DPTR
   \   000332   8E82         MOV     DPL,R6
   \   000334   8F83         MOV     DPH,R7
   \   000336   F0           MOVX    @DPTR,A
   \   000337   8E82         MOV     DPL,R6
   \   000339   8F83         MOV     DPH,R7
   \   00033B   A3           INC     DPTR
   \   00033C   AE82         MOV     R6,DPL
   \   00033E   AF83         MOV     R7,DPH
    526          
    527            /* Data Length */
    528            *tempPtr++ = dataLen;
   \   000340   E5..         MOV     A,?V0 + 8
   \   000342   8E82         MOV     DPL,R6
   \   000344   8F83         MOV     DPH,R7
   \   000346   E5..         MOV     A,?V0 + 8
   \   000348   F0           MOVX    @DPTR,A
   \   000349   8E82         MOV     DPL,R6
   \   00034B   8F83         MOV     DPH,R7
   \   00034D   A3           INC     DPTR
   \   00034E   AE82         MOV     R6,DPL
   \   000350   AF83         MOV     R7,DPH
    529          
    530            /* Data */
    531            if (dataLen)
   \   000352   E5..         MOV     A,?V0 + 8
   \   000354   6031         JZ      ??MT_AfIncomingMsg_7
    532            {
    533              osal_memcpy(tempPtr, pMsg->cmd.Data, dataLen);
   \   000356                ; Setup parameters for call to function osal_memcpy
   \   000356   E5..         MOV     A,?V0 + 0
   \   000358   2421         ADD     A,#0x21
   \   00035A   F582         MOV     DPL,A
   \   00035C   E5..         MOV     A,?V0 + 1
   \   00035E   3400         ADDC    A,#0x0
   \   000360   F583         MOV     DPH,A
   \   000362   E0           MOVX    A,@DPTR
   \   000363   F5..         MOV     ?V0 + 4,A
   \   000365   A3           INC     DPTR
   \   000366   E0           MOVX    A,@DPTR
   \   000367   F5..         MOV     ?V0 + 5,A
   \   000369   75..00       MOV     ?V0 + 6,#0x0
   \   00036C   78..         MOV     R0,#?V0 + 4
   \   00036E   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000371   85....       MOV     ?V0 + 4,?V0 + 8
   \   000374   75..00       MOV     ?V0 + 5,#0x0
   \   000377   AC..         MOV     R4,?V0 + 4
   \   000379   AD..         MOV     R5,?V0 + 5
   \   00037B   EE           MOV     A,R6
   \   00037C   FA           MOV     R2,A
   \   00037D   EF           MOV     A,R7
   \   00037E   FB           MOV     R3,A
   \   00037F   12....       LCALL   ??osal_memcpy?relay
   \   000382   7403         MOV     A,#0x3
   \   000384   12....       LCALL   ?DEALLOC_XSTACK8
    534            }
    535          
    536            /* Build and send back the response */
    537            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ|(uint8)MT_RPC_SYS_AF), cmd, respLen, pRsp);
   \                     ??MT_AfIncomingMsg_7:
   \   000387                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000387   AC..         MOV     R4,?V0 + 10
   \   000389   AD..         MOV     R5,?V0 + 11
   \   00038B   AB..         MOV     R3,?V0 + 3
   \   00038D   AA..         MOV     R2,?V0 + 2
   \   00038F   7944         MOV     R1,#0x44
   \   000391   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    538          
    539            /* Free memory */
    540            osal_mem_free(pRsp);
   \   000394                ; Setup parameters for call to function osal_mem_free
   \   000394   AA..         MOV     R2,?V0 + 10
   \   000396   AB..         MOV     R3,?V0 + 11
   \   000398   12....       LCALL   ??osal_mem_free?relay
    541          }
   \                     ??MT_AfIncomingMsg_2:
   \   00039B   7F0C         MOV     R7,#0xc
   \   00039D   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfCommandProcessing?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfCommandProcessing

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfRegister?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfRegister

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfDataRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfDataRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfDataRequestSrcRtg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfDataRequestSrcRtg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfDataConfirm?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfDataConfirm

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfIncomingMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfIncomingMsg
    542          
    543          /***************************************************************************************************
    544          ***************************************************************************************************/

   Maximum stack usage in bytes:

   ISTACK PSTACK XSTACK Function
   ------ ------ ------ --------
       0      0      9  MT_AfCommandProcessing
                          0 0  9 -> MT_AfDataRequest
                          0 0  9 -> MT_AfDataRequestSrcRtg
                          0 0  9 -> MT_AfRegister
       1      0     12  MT_AfDataConfirm
                          0 0 12 -> MT_BuildAndSendZToolResponse
       1      0     54  MT_AfDataRequest
                          0 0 45 -> AF_DataRequest
                          0 0 36 -> MT_BuildAndSendZToolResponse
                          0 0 36 -> afFindEndPointDesc
                          0 0 39 -> osal_memcpy
       1      0     59  MT_AfDataRequestSrcRtg
                          0 0 50 -> AF_DataRequestSrcRtg
                          0 0 38 -> MT_BuildAndSendZToolResponse
                          0 0 38 -> afFindEndPointDesc
                          0 0 38 -> osal_mem_alloc
                          0 0 38 -> osal_mem_free
                          0 0 38 -> osal_memset
       1      0     23  MT_AfIncomingMsg
                          0 0 20 -> MT_BuildAndSendZToolResponse
                          0 0 20 -> osal_mem_alloc
                          0 0 20 -> osal_mem_free
                          0 0 23 -> osal_memcpy
       1      0     24  MT_AfRegister
                          0 0 15 -> MT_BuildAndSendZToolResponse
                          0 0 15 -> MT_BuildEndpointDesc
                          0 0 15 -> afRegister
                          0 0 15 -> osal_mem_alloc
                          0 0 15 -> osal_mem_free


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
       6  ??MT_AfCommandProcessing?relay
       6  ??MT_AfDataConfirm?relay
       6  ??MT_AfDataRequest?relay
       6  ??MT_AfDataRequestSrcRtg?relay
       6  ??MT_AfIncomingMsg?relay
       6  ??MT_AfRegister?relay
      69  MT_AfCommandProcessing
      91  MT_AfDataConfirm
     617  MT_AfDataRequest
     592  MT_AfDataRequestSrcRtg
     928  MT_AfIncomingMsg
     165  MT_AfRegister

 
 2 462 bytes in segment BANKED_CODE
    36 bytes in segment BANK_RELAYS
 
 2 498 bytes of CODE memory

Errors: none
Warnings: none
